<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <meta
      name="keywords"
      content="microfrontend, micro frontend, micro frontends, micro-frontend, micro-frontends, microservice, javascript"
    />
    <link
      rel="shortcut icon"
      type="image/x-icon"
      href="https://gw.alipayobjects.com/mdn/rms_655822/afts/img/A*4sIUQpcos_gAAAAAAAAAAAAAARQnAQ"
    />
    <style>
      html .__dumi-default-layout-hero {
        padding: 140px 0;
        background: #21144d no-repeat bottom/cover
          url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1600 900'%3E%3Cpolygon fill='%23f3c200' points='957 450 539 900 1396 900'/%3E%3Cpolygon fill='%23e26003' points='957 450 872.9 900 1396 900'/%3E%3Cpolygon fill='%23ecb500' points='-60 900 398 662 816 900'/%3E%3Cpolygon fill='%23d86200' points='337 900 398 662 816 900'/%3E%3Cpolygon fill='%23e4a800' points='1203 546 1552 900 876 900'/%3E%3Cpolygon fill='%23ce6400' points='1203 546 1552 900 1162 900'/%3E%3Cpolygon fill='%23dc9b00' points='641 695 886 900 367 900'/%3E%3Cpolygon fill='%23c46500' points='587 900 641 695 886 900'/%3E%3Cpolygon fill='%23d38f00' points='1710 900 1401 632 1096 900'/%3E%3Cpolygon fill='%23ba6600' points='1710 900 1401 632 1365 900'/%3E%3Cpolygon fill='%23ca8300' points='1210 900 971 687 725 900'/%3E%3Cpolygon fill='%23b16600' points='943 900 1210 900 971 687'/%3E%3C/svg%3E");
      }
      html .__dumi-default-layout-hero h1 {
        color: #f3f3f3;
        text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
      }
      html .__dumi-default-layout-hero .markdown {
        color: #eee;
        text-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
      }
    </style>
    <link rel="stylesheet" href="/qiankun/umi.fef85f5f.css" />
    <script>
      window.routerBase = "/qiankun";
    </script>
    <script>
      //! umi version: 3.5.14
    </script>
    <script>
      !(function () {
        var e = localStorage.getItem("dumi:prefers-color"),
          t = window.matchMedia("(prefers-color-scheme: dark)").matches,
          r = ["light", "dark", "auto"];
        document.documentElement.setAttribute(
          "data-prefers-color",
          e === r[2] ? (t ? r[1] : r[0]) : r.includes(e) ? e : r[0]
        );
      })();
    </script>
    <script>
      var _hmt = _hmt || [];
    </script>
    <script>
      (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?0f738d9b0ac90574c09183ea85bcfa2e";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
      })();
    </script>
    <title>常见问题</title>
  </head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-route="/zh/faq" data-show-sidemenu="true" data-show-slugs="false" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;https://gw.alipayobjects.com/zos/bmw-prod/8a74c1d3-16f3-4719-be63-15e467a68a24/km0cv8vn_w500_h500.png&#x27;)" href="/qiankun/zh">qiankun</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><span><a href="/qiankun/zh/guide">指南</a></span><span><a href="/qiankun/zh/api">API</a></span><span><a aria-current="page" class="active" href="/qiankun/zh/faq">常见问题</a></span><span><a href="/qiankun/zh/cookbook">入门教程</a></span><span>版本公告<ul><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/umijs/qiankun/releases">发布日志<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a href="/qiankun/zh/cookbook#从-1x-版本升级到-2x-版本">升级指南</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://v1.qiankun.umijs.org/zh/">1.x 版本<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></span><span><a target="_blank" rel="noopener noreferrer" href="https://github.com/umijs/qiankun">GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></span><div class="__dumi-default-locale-select" data-locale-count="2"><a href="/qiankun/faq">English</a></div><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "></div></div></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;https://gw.alipayobjects.com/zos/bmw-prod/8a74c1d3-16f3-4719-be63-15e467a68a24/km0cv8vn_w500_h500.png&#x27;)" href="/qiankun/zh"></a><h1>qiankun</h1><p></p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li><a href="/qiankun/zh/guide">指南</a></li><li><a href="/qiankun/zh/api">API</a></li><li><a aria-current="page" class="active" href="/qiankun/zh/faq">常见问题</a></li><li><a href="/qiankun/zh/cookbook">入门教程</a></li><li>版本公告<ul><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/umijs/qiankun/releases">发布日志<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a href="/qiankun/zh/cookbook#从-1x-版本升级到-2x-版本">升级指南</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://v1.qiankun.umijs.org/zh/">1.x 版本<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/umijs/qiankun">GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul><div class="__dumi-default-locale-select" data-locale-count="2"><a href="/qiankun/faq">English</a></div><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "><button title="Dark theme" class="__dumi-default-dark-moon "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3854" width="22" height="22"><path d="M991.816611 674.909091a69.166545 69.166545 0 0 0-51.665455-23.272727 70.795636 70.795636 0 0 0-27.438545 5.585454A415.674182 415.674182 0 0 1 754.993338 698.181818c-209.594182 0-393.472-184.785455-393.472-395.636363 0-52.363636 38.539636-119.621818 69.515637-173.614546 4.887273-8.610909 9.634909-16.756364 14.103272-24.901818A69.818182 69.818182 0 0 0 384.631156 0a70.842182 70.842182 0 0 0-27.438545 5.585455C161.678429 90.298182 14.362065 307.898182 14.362065 512c0 282.298182 238.824727 512 532.38691 512a522.286545 522.286545 0 0 0 453.957818-268.334545A69.818182 69.818182 0 0 0 991.816611 674.909091zM546.679156 954.181818c-248.785455 0-462.941091-192-462.941091-442.181818 0-186.647273 140.637091-372.829091 300.939637-442.181818-36.817455 65.629091-92.578909 151.970909-92.578909 232.727273 0 250.181818 214.109091 465.454545 462.917818 465.454545a488.331636 488.331636 0 0 0 185.181091-46.545455 453.003636 453.003636 0 0 1-393.565091 232.727273z m103.656728-669.323636l-14.266182 83.781818a34.909091 34.909091 0 0 0 50.362182 36.770909l74.775272-39.563636 74.752 39.563636a36.142545 36.142545 0 0 0 16.174546 3.956364 34.909091 34.909091 0 0 0 34.210909-40.727273l-14.289455-83.781818 60.509091-59.345455a35.025455 35.025455 0 0 0-19.223272-59.578182l-83.61891-12.101818-37.376-76.101818a34.56 34.56 0 0 0-62.254545 0l-37.376 76.101818-83.618909 12.101818a34.909091 34.909091 0 0 0-19.246546 59.578182z m70.423272-64.698182a34.280727 34.280727 0 0 0 26.135273-19.083636l14.312727-29.090909 14.336 29.090909a34.257455 34.257455 0 0 0 26.135273 19.083636l32.046546 4.887273-23.272728 22.574545a35.234909 35.234909 0 0 0-10.007272 30.952727l5.46909 32.116364-28.625454-15.127273a34.490182 34.490182 0 0 0-32.302546 0l-28.695272 15.127273 5.469091-32.116364a35.141818 35.141818 0 0 0-9.984-30.952727l-23.272728-22.574545z" p-id="3855"></path></svg></button><button title="Light theme" class="__dumi-default-dark-sun "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4026" width="22" height="22"><path d="M915.2 476.16h-43.968c-24.704 0-44.736 16-44.736 35.84s20.032 35.904 44.736 35.904H915.2c24.768 0 44.8-16.064 44.8-35.904s-20.032-35.84-44.8-35.84zM512 265.6c-136.704 0-246.464 109.824-246.464 246.4 0 136.704 109.76 246.464 246.464 246.464S758.4 648.704 758.4 512c0-136.576-109.696-246.4-246.4-246.4z m0 425.6c-99.008 0-179.2-80.128-179.2-179.2 0-98.944 80.192-179.2 179.2-179.2S691.2 413.056 691.2 512c0 99.072-80.192 179.2-179.2 179.2zM197.44 512c0-19.84-19.136-35.84-43.904-35.84H108.8c-24.768 0-44.8 16-44.8 35.84s20.032 35.904 44.8 35.904h44.736c24.768 0 43.904-16.064 43.904-35.904zM512 198.464c19.776 0 35.84-20.032 35.84-44.8v-44.8C547.84 84.032 531.84 64 512 64s-35.904 20.032-35.904 44.8v44.8c0 24.768 16.128 44.864 35.904 44.864z m0 627.136c-19.776 0-35.904 20.032-35.904 44.8v44.736C476.096 940.032 492.16 960 512 960s35.84-20.032 35.84-44.8v-44.736c0-24.768-16.064-44.864-35.84-44.864z m329.92-592.832c17.472-17.536 20.288-43.072 6.4-57.024-14.016-14.016-39.488-11.2-57.024 6.336-4.736 4.864-26.496 26.496-31.36 31.36-17.472 17.472-20.288 43.008-6.336 57.024 13.952 14.016 39.488 11.2 57.024-6.336 4.8-4.864 26.496-26.56 31.296-31.36zM213.376 759.936c-4.864 4.8-26.56 26.624-31.36 31.36-17.472 17.472-20.288 42.944-6.4 56.96 14.016 13.952 39.552 11.2 57.024-6.336 4.8-4.736 26.56-26.496 31.36-31.36 17.472-17.472 20.288-43.008 6.336-56.96-14.016-13.952-39.552-11.072-56.96 6.336z m19.328-577.92c-17.536-17.536-43.008-20.352-57.024-6.336-14.08 14.016-11.136 39.488 6.336 57.024 4.864 4.864 26.496 26.56 31.36 31.424 17.536 17.408 43.008 20.288 56.96 6.336 14.016-14.016 11.264-39.488-6.336-57.024-4.736-4.864-26.496-26.56-31.296-31.424z m527.168 628.608c4.864 4.864 26.624 26.624 31.36 31.424 17.536 17.408 43.072 20.224 57.088 6.336 13.952-14.016 11.072-39.552-6.4-57.024-4.864-4.8-26.56-26.496-31.36-31.36-17.472-17.408-43.072-20.288-57.024-6.336-13.952 14.016-11.008 39.488 6.336 56.96z" p-id="4027"></path></svg></button><button title="Default to system" class="__dumi-default-dark-auto "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="11002" width="22" height="22"><path d="M127.658667 492.885333c0-51.882667 10.24-101.717333 30.378666-149.162666s47.786667-88.064 81.92-122.538667 75.093333-61.781333 122.538667-81.92 96.938667-30.378667 149.162667-30.378667 101.717333 10.24 149.162666 30.378667 88.405333 47.786667 122.88 81.92 61.781333 75.093333 81.92 122.538667 30.378667 96.938667 30.378667 149.162666-10.24 101.717333-30.378667 149.162667-47.786667 88.405333-81.92 122.88-75.093333 61.781333-122.88 81.92-97.28 30.378667-149.162666 30.378667-101.717333-10.24-149.162667-30.378667-88.064-47.786667-122.538667-81.92-61.781333-75.093333-81.92-122.88-30.378667-96.938667-30.378666-149.162667z m329.045333 0c0 130.048 13.994667 244.394667 41.984 343.381334h12.970667c46.762667 0 91.136-9.216 133.461333-27.306667s78.848-42.666667 109.568-73.386667 54.954667-67.242667 73.386667-109.568 27.306667-86.698667 27.306666-133.461333c0-46.421333-9.216-90.794667-27.306666-133.12s-42.666667-78.848-73.386667-109.568-67.242667-54.954667-109.568-73.386667-86.698667-27.306667-133.461333-27.306666h-11.605334c-28.672 123.562667-43.349333 237.909333-43.349333 343.722666z" p-id="11003"></path></svg></button></div></div></div><ul class="__dumi-default-menu-list"><li><a aria-current="page" class="active" href="/qiankun/zh/faq">常见问题</a><ul role="slug-list"><li title="Application died in status LOADING_SOURCE_CODE: You need to export the functional lifecycles in xxx entry" data-depth="2"><a href="/qiankun/zh/faq#application-died-in-status-loading_source_code-you-need-to-export-the-functional-lifecycles-in-xxx-entry"><span>Application died in status LOADING_SOURCE_CODE: You need to export the functional lifecycles in xxx entry</span></a></li><li title="Application died in status NOT_MOUNTED: Target container with #container not existed after xxx mounted!" data-depth="2"><a href="/qiankun/zh/faq#application-died-in-status-not_mounted-target-container-with-container-not-existed-after-xxx-mounted"><span>Application died in status NOT_MOUNTED: Target container with #container not existed after xxx mounted!</span></a></li><li title="Application died in status NOT_MOUNTED: Target container with #container not existed while xxx mounting!" data-depth="2"><a href="/qiankun/zh/faq#application-died-in-status-not_mounted-target-container-with-container-not-existed-while-xxx-mounting"><span>Application died in status NOT_MOUNTED: Target container with #container not existed while xxx mounting!</span></a></li><li title="Application died in status NOT_MOUNTED: Target container with #container not existed while xxx loading!" data-depth="2"><a href="/qiankun/zh/faq#application-died-in-status-not_mounted-target-container-with-container-not-existed-while-xxx-loading"><span>Application died in status NOT_MOUNTED: Target container with #container not existed while xxx loading!</span></a></li><li title="如何在主应用的某个路由页面加载微应用" data-depth="2"><a href="/qiankun/zh/faq#如何在主应用的某个路由页面加载微应用"><span>如何在主应用的某个路由页面加载微应用</span></a></li><li title="Vue Router 报错 Uncaught TypeError: Cannot redefine property: $router" data-depth="2"><a href="/qiankun/zh/faq#vue-router-报错-uncaught-typeerror-cannot-redefine-property-router"><span>Vue Router 报错 Uncaught TypeError: Cannot redefine property: $router</span></a></li><li title="为什么微应用加载的资源会 404？" data-depth="2"><a href="/qiankun/zh/faq#为什么微应用加载的资源会-404？"><span>为什么微应用加载的资源会 404？</span></a></li><li title="a. 使用 webpack 运行时 publicPath 配置" data-depth="3"><a href="/qiankun/zh/faq#a-使用-webpack-运行时-publicpath-配置"><span>a. 使用 webpack 运行时 publicPath 配置</span></a></li><li title="b. 使用 webpack 静态 publicPath 配置" data-depth="3"><a href="/qiankun/zh/faq#b-使用-webpack-静态-publicpath-配置"><span>b. 使用 webpack 静态 publicPath 配置</span></a></li><li title="微应用打包之后 css 中的字体文件和图片加载 404" data-depth="3"><a href="/qiankun/zh/faq#微应用打包之后-css-中的字体文件和图片加载-404"><span>微应用打包之后 css 中的字体文件和图片加载 404</span></a></li><li title="微应用静态资源一定要支持跨域吗？" data-depth="2"><a href="/qiankun/zh/faq#微应用静态资源一定要支持跨域吗？"><span>微应用静态资源一定要支持跨域吗？</span></a></li><li title="如何解决由于运营商动态插入的脚本加载异常导致微应用加载失败的问题" data-depth="2"><a href="/qiankun/zh/faq#如何解决由于运营商动态插入的脚本加载异常导致微应用加载失败的问题"><span>如何解决由于运营商动态插入的脚本加载异常导致微应用加载失败的问题</span></a></li><li title="使用自定义的 getTemplate 方法" data-depth="3"><a href="/qiankun/zh/faq#使用自定义的-gettemplate-方法"><span>使用自定义的 getTemplate 方法</span></a></li><li title="使用自定义的 fetch 方法" data-depth="3"><a href="/qiankun/zh/faq#使用自定义的-fetch-方法"><span>使用自定义的 fetch 方法</span></a></li><li title="将微应用的 HTML 的 response content-type 改为 text/plain（终极方案）" data-depth="3"><a href="/qiankun/zh/faq#将微应用的-html-的-response-content-type-改为-textplain（终极方案）"><span>将微应用的 HTML 的 response content-type 改为 text/plain（终极方案）</span></a></li><li title="如何确保主应用跟微应用之间的样式隔离" data-depth="2"><a href="/qiankun/zh/faq#如何确保主应用跟微应用之间的样式隔离"><span>如何确保主应用跟微应用之间的样式隔离</span></a></li><li title="如何独立运行微应用？" data-depth="2"><a href="/qiankun/zh/faq#如何独立运行微应用？"><span>如何独立运行微应用？</span></a></li><li title="如何同时激活两个微应用？" data-depth="2"><a href="/qiankun/zh/faq#如何同时激活两个微应用？"><span>如何同时激活两个微应用？</span></a></li><li title="如何提取出公共的依赖库？" data-depth="2"><a href="/qiankun/zh/faq#如何提取出公共的依赖库？"><span>如何提取出公共的依赖库？</span></a></li><li title="qiankun 能兼容 ie 吗？" data-depth="2"><a href="/qiankun/zh/faq#qiankun-能兼容-ie-吗？"><span>qiankun 能兼容 ie 吗？</span></a></li><li title="如何给 ie 打补丁？" data-depth="3"><a href="/qiankun/zh/faq#如何给-ie-打补丁？"><span>如何给 ie 打补丁？</span></a></li><li title="报错 Here is no &quot;fetch&quot; on the window env, you need to polyfill it" data-depth="2"><a href="/qiankun/zh/faq#报错-here-is-no-fetch-on-the-window-env-you-need-to-polyfill-it"><span>报错 Here is no &quot;fetch&quot; on the window env, you need to polyfill it</span></a></li><li title="微应用 JSONP 跨域错误怎么处理？" data-depth="2"><a href="/qiankun/zh/faq#微应用-jsonp-跨域错误怎么处理？"><span>微应用 JSONP 跨域错误怎么处理？</span></a></li><li title="微应用路径下刷新后 404？" data-depth="2"><a href="/qiankun/zh/faq#微应用路径下刷新后-404？"><span>微应用路径下刷新后 404？</span></a></li><li title="主应用如何配置 404 页面？" data-depth="2"><a href="/qiankun/zh/faq#主应用如何配置-404-页面？"><span>主应用如何配置 404 页面？</span></a></li><li title="微应用之间如何跳转？" data-depth="2"><a href="/qiankun/zh/faq#微应用之间如何跳转？"><span>微应用之间如何跳转？</span></a></li><li title="微应用文件更新之后，访问的还是旧版文件" data-depth="2"><a href="/qiankun/zh/faq#微应用文件更新之后，访问的还是旧版文件"><span>微应用文件更新之后，访问的还是旧版文件</span></a></li><li title="使用 config entry 时微应用样式丢失" data-depth="2"><a href="/qiankun/zh/faq#使用-config-entry-时微应用样式丢失"><span>使用 config entry 时微应用样式丢失</span></a></li><li title="如何解决拉取微应用 entry 时 cookie 未携带的问题" data-depth="2"><a href="/qiankun/zh/faq#如何解决拉取微应用-entry-时-cookie-未携带的问题"><span>如何解决拉取微应用 entry 时 cookie 未携带的问题</span></a></li></ul></li></ul></div></div><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="常见问题"><a aria-hidden="true" tabindex="-1" href="/qiankun/zh/faq#常见问题"><span class="icon icon-link"></span></a>常见问题</h1><h2 id="application-died-in-status-loading_source_code-you-need-to-export-the-functional-lifecycles-in-xxx-entry"><a aria-hidden="true" tabindex="-1" href="/qiankun/zh/faq#application-died-in-status-loading_source_code-you-need-to-export-the-functional-lifecycles-in-xxx-entry"><span class="icon icon-link"></span></a><code>Application died in status LOADING_SOURCE_CODE: You need to export the functional lifecycles in xxx entry</code></h2><p>qiankun 抛出这个错误是因为无法从微应用的 entry js 中识别出其导出的生命周期钩子。</p><p>可以通过以下几个步骤解决这个问题：</p><ol><li><p>检查微应用是否已经导出相应的生命周期钩子，参考<a href="/qiankun/zh/guide/getting-started#1-%E5%AF%BC%E5%87%BA%E7%9B%B8%E5%BA%94%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E9%92%A9%E5%AD%90">文档</a>。</p></li><li><p>检查微应用的 webpack 是否增加了指定的配置，参考<a href="/qiankun/zh/guide/getting-started#2-%E9%85%8D%E7%BD%AE%E5%BE%AE%E5%BA%94%E7%94%A8%E7%9A%84%E6%89%93%E5%8C%85%E5%B7%A5%E5%85%B7">文档</a>。</p></li><li><p>检查微应用的 webpack 是否配置了 <code>output.globalObject</code> 的值，如果有请确保其值为 <code>window</code>，或者移除该配置从而使用默认值。</p></li><li><p>检查微应用的 <code>package.json</code> 中的 <code>name</code> 字段是否是微应用中唯一的。</p></li><li><p>检查微应用的 entry html 中入口的 js 是不是最后一个加载的脚本。如果不是，需要移动顺序将其变成最后一个加载的 js，或者在 html 中将入口 js 手动标记为 <code>entry</code>，如：</p><div class="__dumi-default-code-block"><pre class="prism-code language-html"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token tag punctuation">&lt;</span><span class="token tag">script</span><span class="token tag"> </span><span class="token tag attr-name">src</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">/antd.js</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag punctuation">&gt;</span><span class="token script"></span><span class="token tag punctuation">&lt;/</span><span class="token tag">script</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token tag punctuation">&lt;</span><span class="token tag">script</span><span class="token tag"> </span><span class="token tag attr-name">src</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">/appEntry.js</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag"> </span><span class="token tag attr-name">entry</span><span class="token tag punctuation">&gt;</span><span class="token script"></span><span class="token tag punctuation">&lt;/</span><span class="token tag">script</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token tag punctuation">&lt;</span><span class="token tag">script</span><span class="token tag"> </span><span class="token tag attr-name">src</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">https://www.google.com/analytics.js</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag punctuation">&gt;</span><span class="token script"></span><span class="token tag punctuation">&lt;/</span><span class="token tag">script</span><span class="token tag punctuation">&gt;</span></div></pre></div></li><li><p>如果开发环境可以，生产环境不行，检查微应用的 <code>index.html</code> 和 <code>entry js</code> 是否正常返回，比如说返回了 <code>404.html</code>。</p></li><li><p>如果你正在使用 webpack5，请看<a target="_blank" rel="noopener noreferrer" href="https://github.com/umijs/qiankun/issues/1092">这个 issues<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li></ol><p>如果在上述步骤完成后仍有问题，通常说明是浏览器兼容性问题导致的。可以尝试 <strong>将有问题的微应用的 webpack <code>output.library</code> 配置成跟主应用中注册的 <code>name</code> 字段一致</strong>，如：</p><p>假如主应用配置是这样的：</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment">// 主应用</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token function">registerMicroApps</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;brokenSubApp&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    entry</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;//localhost:7100&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    container</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;#yourContainer&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    activeRule</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;/react&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>将微应用的 <code>output.library</code> 改为跟主应用中注册的一致：</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">module</span><span class="token punctuation">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  output</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// 这里改成跟主应用中注册的一致</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    library</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;brokenSubApp&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    libraryTarget</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;umd&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    jsonpFunction</span><span class="token operator">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string">`</span><span class="token template-string string">webpackJsonp_</span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">packageName</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span></div></pre></div><h2 id="application-died-in-status-not_mounted-target-container-with-container-not-existed-after-xxx-mounted"><a aria-hidden="true" tabindex="-1" href="/qiankun/zh/faq#application-died-in-status-not_mounted-target-container-with-container-not-existed-after-xxx-mounted"><span class="icon icon-link"></span></a><code>Application died in status NOT_MOUNTED: Target container with #container not existed after xxx mounted!</code></h2><p>qiankun 抛出这个错误是因为微应用加载后容器 DOM 节点不存在了。可能的原因有：</p><ol><li><p>微应用的根 <code>id</code> 与其他 DOM 冲突。解决办法是：修改根 <code>id</code> 的查找范围。</p><p><code>vue</code> 微应用：</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">props </span><span class="token parameter operator">=</span><span class="token parameter"> </span><span class="token parameter punctuation">{</span><span class="token parameter punctuation">}</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> container </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> props</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  instance </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    router</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    store</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function-variable function">render</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">h</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token function">h</span><span class="token punctuation">(</span><span class="token maybe-class-name">App</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">$mount</span><span class="token punctuation">(</span><span class="token plain">container </span><span class="token operator">?</span><span class="token plain"> container</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">&#x27;#app&#x27;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;#app&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword">async</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">render</span><span class="token punctuation">(</span><span class="token plain">props</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p><code>react</code> 微应用：</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> container </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> props</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token maybe-class-name">ReactDOM</span><span class="token punctuation">.</span><span class="token method function property-access">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token maybe-class-name">App</span><span class="token plain"> </span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span><span class="token plain"> container </span><span class="token operator">?</span><span class="token plain"> container</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">&#x27;#root&#x27;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">:</span><span class="token plain"> </span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">&#x27;#root&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword">async</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">render</span><span class="token punctuation">(</span><span class="token plain">props</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword">async</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">unmount</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> container </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> props</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token maybe-class-name">ReactDOM</span><span class="token punctuation">.</span><span class="token method function property-access">unmountComponentAtNode</span><span class="token punctuation">(</span><span class="token plain">container </span><span class="token operator">?</span><span class="token plain"> container</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">&#x27;#root&#x27;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">:</span><span class="token plain"> </span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">&#x27;#root&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div></li><li><p>微应用的某些 js 里面使用了 <code>document.write</code>，比如高德地图 1.x 版本，腾讯地图 2.x 版本。</p><p>如果是地图 js 导致的，先看看升级能否解决，比如说高德地图升级到 2.x 版本即可。</p><p>如果升级无法解决，建议将地图放到主应用加载，微应用也引入这个地图 js（独立运行时使用），但是给 <code>&lt;script&gt;</code> 标签加上 <code>ignore</code> 属性：</p><div class="__dumi-default-code-block"><pre class="prism-code language-html"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token tag punctuation">&lt;</span><span class="token tag">script</span><span class="token tag"> </span><span class="token tag attr-name">src</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">https://map.qq.com/api/gljs?v=1.exp</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag"> </span><span class="token tag attr-name">ignore</span><span class="token tag punctuation">&gt;</span><span class="token script"></span><span class="token tag punctuation">&lt;/</span><span class="token tag">script</span><span class="token tag punctuation">&gt;</span></div></pre></div><p>如果是其他的情况，请不要使用 <code>document.write</code> 。</p></li></ol><h2 id="application-died-in-status-not_mounted-target-container-with-container-not-existed-while-xxx-mounting"><a aria-hidden="true" tabindex="-1" href="/qiankun/zh/faq#application-died-in-status-not_mounted-target-container-with-container-not-existed-while-xxx-mounting"><span class="icon icon-link"></span></a><code>Application died in status NOT_MOUNTED: Target container with #container not existed while xxx mounting!</code></h2><p>这个报错通常出现在主应用为 vue 时，容器写在了路由页面并且使用了路由过渡效果，一些特殊的过渡效果会导致微应用在 mounting 的过程中容器不存在，解决办法就是换成其他的过渡效果，或者去掉路由过渡。</p><h2 id="application-died-in-status-not_mounted-target-container-with-container-not-existed-while-xxx-loading"><a aria-hidden="true" tabindex="-1" href="/qiankun/zh/faq#application-died-in-status-not_mounted-target-container-with-container-not-existed-while-xxx-loading"><span class="icon icon-link"></span></a><code>Application died in status NOT_MOUNTED: Target container with #container not existed while xxx loading!</code></h2><p>与上面的报错类似，这个报错是因为微应用加载时容器 DOM 不存在。一般是因为 <code>start</code> 函数调用时机不正确导致的，调整 <code>start</code> 函数调用时机即可。</p><p>如何判断容器 DOM 加载完成？vue 应用可以在 <code>mounted</code> 生命周期调用，react 应用可以在 <code>componentDidMount</code> 生命周期调用。</p><p>如果仍然报错，检查容器 DOM 是否放在了主应用的某个路由页面，请参考<a href="/qiankun/zh/faq#%E5%A6%82%E4%BD%95%E5%9C%A8%E4%B8%BB%E5%BA%94%E7%94%A8%E7%9A%84%E6%9F%90%E4%B8%AA%E8%B7%AF%E7%94%B1%E9%A1%B5%E9%9D%A2%E5%8A%A0%E8%BD%BD%E5%BE%AE%E5%BA%94%E7%94%A8">如何在主应用的某个路由页面加载微应用</a>。</p><h2 id="如何在主应用的某个路由页面加载微应用"><a aria-hidden="true" tabindex="-1" href="/qiankun/zh/faq#如何在主应用的某个路由页面加载微应用"><span class="icon icon-link"></span></a>如何在主应用的某个路由页面加载微应用</h2><p>必须保证微应用加载时主应用这个路由页面也加载了。</p><p><code>vue</code> + <code>vue-router</code> 技术栈的主应用：</p><ol><li>主应用注册这个路由时给 <code>path</code> 加一个 <code>*</code>，<strong>注意：如果这个路由有其他子路由，需要另外注册一个路由，仍然使用这个组件即可</strong>。<div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> routes </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    path</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;/portal/*&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;portal&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function-variable function">component</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">&#x27;../views/Portal.vue&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">]</span><span class="token punctuation">;</span></div></pre></div></li><li>微应用的 <code>activeRule</code> 需要包含主应用的这个路由 <code>path</code>。<div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token function">registerMicroApps</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;app1&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    entry</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;http://localhost:8080&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    container</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;#container&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    activeRule</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;/portal/app1&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div></li><li>在 <code>Portal.vue</code> 这个组件的 <code>mounted</code> 周期调用 <code>start</code> 函数，<strong>注意不要重复调用</strong>。<div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports punctuation">{</span><span class="token imports"> start </span><span class="token imports punctuation">}</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&#x27;qiankun&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword module">default</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">qiankunStarted</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">qiankunStarted</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span></div></pre></div></li></ol><p><code>react</code> + <code>react-router</code> 技术栈的主应用：只需要让微应用的 <code>activeRule</code> 包含主应用的这个路由即可。</p><p><code>angular</code> + <code>angular-router</code> 技术栈的主应用，与 vue 项目类似：</p><ol><li><p>主应用给这个路由注册一个通配符的子路由，内容为空。</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> routes</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">Routes</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    path</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;portal&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    component</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">PortalComponent</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    children</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token plain"> path</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;**&#x27;</span><span class="token punctuation">,</span><span class="token plain"> component</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">EmptyComponent</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">]</span><span class="token punctuation">;</span></div></pre></div></li><li><p>微应用的 <code>activeRule</code> 需要包含主应用的这个路由 <code>path</code>。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token function">registerMicroApps</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;app1&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    entry</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;http://localhost:8080&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    container</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;#container&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    activeRule</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;/portal/app1&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div></li><li><p>在这个路由组件的 <code>ngAfterViewInit</code> 周期调用 <code>start</code> 函数，<strong>注意不要重复调用</strong>。</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token imports punctuation">{</span><span class="token imports"> start </span><span class="token imports punctuation">}</span><span class="token plain"> </span><span class="token keyword">from</span><span class="token plain"> </span><span class="token string">&#x27;qiankun&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">export</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> </span><span class="token class-name maybe-class-name">PortalComponent</span><span class="token plain"> </span><span class="token keyword">implements</span><span class="token plain"> </span><span class="token class-name maybe-class-name">AfterViewInit</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">ngAfterViewInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> </span><span class="token keyword">void</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">qiankunStarted</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">qiankunStarted</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div></li></ol><h2 id="vue-router-报错-uncaught-typeerror-cannot-redefine-property-router"><a aria-hidden="true" tabindex="-1" href="/qiankun/zh/faq#vue-router-报错-uncaught-typeerror-cannot-redefine-property-router"><span class="icon icon-link"></span></a>Vue Router 报错 <code>Uncaught TypeError: Cannot redefine property: $router</code></h2><p>qiankun 中的代码使用 Proxy 去代理父页面的 window，来实现的沙箱，在微应用中访问 <code>window.Vue</code> 时，会先在自己的 window 里查找有没有 <code>Vue</code> 属性，如果没有就去父应用里查找。</p><p>在 VueRouter 的代码里有这样三行代码，会在模块加载的时候就访问 <code>window.Vue</code> 这个变量，微应用中报这个错，一般是由于父应用中的 Vue 挂载到了父应用的 <code>window</code> 对象上了。</p><div class="__dumi-default-code-block"><pre class="prism-code language-javascript"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">inBrowser </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access maybe-class-name">Vue</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access maybe-class-name">Vue</span><span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token maybe-class-name">VueRouter</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>可以从以下方式中选择一种来解决问题：</p><ol><li>在主应用中不使用 CDN 等 external 的方式来加载 <code>Vue</code> 框架，使用前端打包软件来加载模块</li><li>在主应用中，将 <code>window.Vue</code> 变量改个名称，例如 <code>window.Vue2 = window.Vue; window.Vue = undefined</code></li></ol><h2 id="为什么微应用加载的资源会-404？"><a aria-hidden="true" tabindex="-1" href="/qiankun/zh/faq#为什么微应用加载的资源会-404？"><span class="icon icon-link"></span></a>为什么微应用加载的资源会 404？</h2><p>原因是 webpack 加载资源时未使用正确的 <code>publicPath</code>。</p><p>可以通过以下两个方式解决这个问题：</p><h3 id="a-使用-webpack-运行时-publicpath-配置"><a aria-hidden="true" tabindex="-1" href="/qiankun/zh/faq#a-使用-webpack-运行时-publicpath-配置"><span class="icon icon-link"></span></a>a. 使用 webpack 运行时 publicPath 配置</h3><p>qiankun 将会在微应用 bootstrap 之前注入一个运行时的 publicPath 变量，你需要做的是在微应用的 entry js 的顶部添加如下代码：</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">__webpack_public_path__ </span><span class="token operator">=</span><span class="token plain"> </span><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">__INJECTED_PUBLIC_PATH_BY_QIANKUN__</span><span class="token punctuation">;</span></div></pre></div><p>关于运行时 publicPath 的技术细节，可以参考 <a target="_blank" rel="noopener noreferrer" href="https://webpack.js.org/guides/public-path/#on-the-fly">webpack 文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p><div class="__dumi-default-alert" type="info">runtime publicPath 主要解决的是微应用动态载入的 脚本、样式、图片 等地址不正确的问题。</div><h3 id="b-使用-webpack-静态-publicpath-配置"><a aria-hidden="true" tabindex="-1" href="/qiankun/zh/faq#b-使用-webpack-静态-publicpath-配置"><span class="icon icon-link"></span></a>b. 使用 webpack 静态 publicPath 配置</h3><p>你需要将你的 webpack <code>publicPath</code> 配置设置成一个绝对地址的 url，比如在开发环境可能是：</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  output</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    publicPath</span><span class="token operator">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string">`</span><span class="token template-string string">//localhost:</span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">port</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><h3 id="微应用打包之后-css-中的字体文件和图片加载-404"><a aria-hidden="true" tabindex="-1" href="/qiankun/zh/faq#微应用打包之后-css-中的字体文件和图片加载-404"><span class="icon icon-link"></span></a>微应用打包之后 css 中的字体文件和图片加载 404</h3><p>原因是 <code>qiankun</code> 将外链样式改成了内联样式，但是字体文件和背景图片的加载路径是相对路径。</p><p>而 <code>css</code> 文件一旦打包完成，就无法通过动态修改 <code>publicPath</code> 来修正其中的字体文件和背景图片的路径。</p><p>主要有以下几个解决方案：</p><ol><li><p>所有图片等静态资源上传至 <code>cdn</code>，<code>css</code> 中直接引用 <code>cdn</code> 地址（<strong>推荐</strong>）</p></li><li><p>借助 <code>webpack</code> 的 <code>url-loader</code> 将字体文件和图片打包成 <code>base64</code>（适用于字体文件和图片体积小的项目）（<strong>推荐</strong>）</p></li></ol><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">module</span><span class="token punctuation">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  module</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    rules</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        test</span><span class="token operator">:</span><span class="token plain"> </span><span class="token regex regex-delimiter">/</span><span class="token regex regex-source language-regex">\.(png|jpe?g|gif|webp|woff2?|eot|ttf|otf)$</span><span class="token regex regex-delimiter">/</span><span class="token regex regex-flags">i</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        use</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            loader</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;url-loader&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            options</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span></div></pre></div><p><code>vue-cli3</code> 项目写法：</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">module</span><span class="token punctuation">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function-variable function">chainWebpack</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    config</span><span class="token punctuation">.</span><span class="token property-access">module</span><span class="token punctuation">.</span><span class="token method function property-access">rule</span><span class="token punctuation">(</span><span class="token string">&#x27;fonts&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token string">&#x27;url-loader&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">loader</span><span class="token punctuation">(</span><span class="token string">&#x27;url-loader&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">options</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    config</span><span class="token punctuation">.</span><span class="token property-access">module</span><span class="token punctuation">.</span><span class="token method function property-access">rule</span><span class="token punctuation">(</span><span class="token string">&#x27;images&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token string">&#x27;url-loader&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">loader</span><span class="token punctuation">(</span><span class="token string">&#x27;url-loader&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">options</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span></div></pre></div><ol start="3"><li>借助 <code>webpack</code> 的 <code>file-loader</code> ，在打包时给其注入完整路径（适用于字体文件和图片体积比较大的项目）</li></ol><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> publicPath </span><span class="token operator">=</span><span class="token plain"> process</span><span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">NODE_ENV</span><span class="token plain"> </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string">&#x27;production&#x27;</span><span class="token plain"> </span><span class="token operator">?</span><span class="token plain"> </span><span class="token string">&#x27;https://qiankun.umijs.org/&#x27;</span><span class="token plain"> </span><span class="token operator">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string">`</span><span class="token template-string string">http://localhost:</span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">port</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">module</span><span class="token punctuation">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  module</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    rules</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        test</span><span class="token operator">:</span><span class="token plain"> </span><span class="token regex regex-delimiter">/</span><span class="token regex regex-source language-regex">\.(png|jpe?g|gif|webp)$</span><span class="token regex regex-delimiter">/</span><span class="token regex regex-flags">i</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        use</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            loader</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;file-loader&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            options</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">              name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;img/[name].[hash:8].[ext]&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">              publicPath</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        test</span><span class="token operator">:</span><span class="token plain"> </span><span class="token regex regex-delimiter">/</span><span class="token regex regex-source language-regex">\.(woff2?|eot|ttf|otf)$</span><span class="token regex regex-delimiter">/</span><span class="token regex regex-flags">i</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        use</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            loader</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;file-loader&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            options</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">              name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;fonts/[name].[hash:8].[ext]&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">              publicPath</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span></div></pre></div><p><code>vue-cli3</code> 项目写法：</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> publicPath </span><span class="token operator">=</span><span class="token plain"> process</span><span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">NODE_ENV</span><span class="token plain"> </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string">&#x27;production&#x27;</span><span class="token plain"> </span><span class="token operator">?</span><span class="token plain"> </span><span class="token string">&#x27;https://qiankun.umijs.org/&#x27;</span><span class="token plain"> </span><span class="token operator">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string">`</span><span class="token template-string string">http://localhost:</span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">port</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">module</span><span class="token punctuation">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function-variable function">chainWebpack</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> fontRule </span><span class="token operator">=</span><span class="token plain"> config</span><span class="token punctuation">.</span><span class="token property-access">module</span><span class="token punctuation">.</span><span class="token method function property-access">rule</span><span class="token punctuation">(</span><span class="token string">&#x27;fonts&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    fontRule</span><span class="token punctuation">.</span><span class="token property-access">uses</span><span class="token punctuation">.</span><span class="token method function property-access">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    fontRule</span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token string">&#x27;file-loader&#x27;</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token method function property-access">loader</span><span class="token punctuation">(</span><span class="token string">&#x27;file-loader&#x27;</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token method function property-access">options</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;fonts/[name].[hash:8].[ext]&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        publicPath</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token method function property-access">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> imgRule </span><span class="token operator">=</span><span class="token plain"> config</span><span class="token punctuation">.</span><span class="token property-access">module</span><span class="token punctuation">.</span><span class="token method function property-access">rule</span><span class="token punctuation">(</span><span class="token string">&#x27;images&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    imgRule</span><span class="token punctuation">.</span><span class="token property-access">uses</span><span class="token punctuation">.</span><span class="token method function property-access">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    imgRule</span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token string">&#x27;file-loader&#x27;</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token method function property-access">loader</span><span class="token punctuation">(</span><span class="token string">&#x27;file-loader&#x27;</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token method function property-access">options</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;img/[name].[hash:8].[ext]&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        publicPath</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token method function property-access">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span></div></pre></div><ol start="4"><li>将两种方案结合起来，小文件转 <code>base64</code> ，大文件注入路径前缀</li></ol><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> publicPath </span><span class="token operator">=</span><span class="token plain"> process</span><span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">NODE_ENV</span><span class="token plain"> </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string">&#x27;production&#x27;</span><span class="token plain"> </span><span class="token operator">?</span><span class="token plain"> </span><span class="token string">&#x27;https://qiankun.umijs.org/&#x27;</span><span class="token plain"> </span><span class="token operator">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string">`</span><span class="token template-string string">http://localhost:</span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">port</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">module</span><span class="token punctuation">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  module</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    rules</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        test</span><span class="token operator">:</span><span class="token plain"> </span><span class="token regex regex-delimiter">/</span><span class="token regex regex-source language-regex">\.(png|jpe?g|gif|webp)$</span><span class="token regex regex-delimiter">/</span><span class="token regex regex-flags">i</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        use</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            loader</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;url-loader&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            options</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            fallback</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">              loader</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;file-loader&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">              options</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">                name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;img/[name].[hash:8].[ext]&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">                publicPath</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">              </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        test</span><span class="token operator">:</span><span class="token plain"> </span><span class="token regex regex-delimiter">/</span><span class="token regex regex-source language-regex">\.(woff2?|eot|ttf|otf)$</span><span class="token regex regex-delimiter">/</span><span class="token regex regex-flags">i</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        use</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            loader</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;url-loader&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            options</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            fallback</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">              loader</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;file-loader&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">              options</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">                name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;fonts/[name].[hash:8].[ext]&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">                publicPath</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">              </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span></div></pre></div><p><code>vue-cli3</code> 项目写法：</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> publicPath </span><span class="token operator">=</span><span class="token plain"> process</span><span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">NODE_ENV</span><span class="token plain"> </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string">&#x27;production&#x27;</span><span class="token plain"> </span><span class="token operator">?</span><span class="token plain"> </span><span class="token string">&#x27;https://qiankun.umijs.org/&#x27;</span><span class="token plain"> </span><span class="token operator">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string">`</span><span class="token template-string string">http://localhost:</span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">port</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">module</span><span class="token punctuation">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function-variable function">chainWebpack</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    config</span><span class="token punctuation">.</span><span class="token property-access">module</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token method function property-access">rule</span><span class="token punctuation">(</span><span class="token string">&#x27;fonts&#x27;</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token string">&#x27;url-loader&#x27;</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token method function property-access">loader</span><span class="token punctuation">(</span><span class="token string">&#x27;url-loader&#x27;</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token method function property-access">options</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        limit</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">4096</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token comment">// 小于4kb将会被打包成 base64</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        fallback</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          loader</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;file-loader&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          options</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;fonts/[name].[hash:8].[ext]&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            publicPath</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token method function property-access">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    config</span><span class="token punctuation">.</span><span class="token property-access">module</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token method function property-access">rule</span><span class="token punctuation">(</span><span class="token string">&#x27;images&#x27;</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token string">&#x27;url-loader&#x27;</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token method function property-access">loader</span><span class="token punctuation">(</span><span class="token string">&#x27;url-loader&#x27;</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token method function property-access">options</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        limit</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">4096</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token comment">// 小于4kb将会被打包成 base64</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        fallback</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          loader</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;file-loader&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          options</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;img/[name].[hash:8].[ext]&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            publicPath</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span></div></pre></div><ol start="5"><li><code>vue-cli3</code> 项目可以将 <code>css</code> 打包到 <code>js</code>里面，不单独生成文件(不推荐，仅适用于 <code>css</code> 较少的项目)</li></ol><p>配置参考 <a target="_blank" rel="noopener noreferrer" href="https://cli.vuejs.org/zh/config/#css-extract">vue-cli3 官网<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>:</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">module</span><span class="token punctuation">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  css</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    extract</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span></div></pre></div><h2 id="微应用静态资源一定要支持跨域吗？"><a aria-hidden="true" tabindex="-1" href="/qiankun/zh/faq#微应用静态资源一定要支持跨域吗？"><span class="icon icon-link"></span></a>微应用静态资源一定要支持跨域吗？</h2><p>是的。</p><p>由于 qiankun 是通过 fetch 去获取微应用的引入的静态资源的，所以必须要求这些静态资源支持<a target="_blank" rel="noopener noreferrer" href="https://developer.mozilla.org/zh/docs/Web/HTTP/Access_control_CORS">跨域<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p><p>如果是自己的脚本，可以通过开发服务端跨域来支持。如果是三方脚本且无法为其添加跨域头，可以将脚本拖到本地，由自己的服务器 serve 来支持跨域。</p><p>参考：<a target="_blank" rel="noopener noreferrer" href="https://segmentfault.com/a/1190000012550346">Nginx 跨域配置<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><h2 id="如何解决由于运营商动态插入的脚本加载异常导致微应用加载失败的问题"><a aria-hidden="true" tabindex="-1" href="/qiankun/zh/faq#如何解决由于运营商动态插入的脚本加载异常导致微应用加载失败的问题"><span class="icon icon-link"></span></a>如何解决由于运营商动态插入的脚本加载异常导致微应用加载失败的问题</h2><p>运营商插入的脚本通常会用 async 标记从而避免 block 微应用的加载，这种通常没问题，如：</p><div class="__dumi-default-code-block"><pre class="prism-code language-html"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token tag punctuation">&lt;</span><span class="token tag">script</span><span class="token tag"> </span><span class="token tag attr-name">async</span><span class="token tag"> </span><span class="token tag attr-name">src</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">//www.rogue.com/rogue.js</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag punctuation">&gt;</span><span class="token script"></span><span class="token tag punctuation">&lt;/</span><span class="token tag">script</span><span class="token tag punctuation">&gt;</span></div></pre></div><p>但如果有些插入的脚本不是被标记成 async 的，这类脚本一旦运行失败，将会导致整个应用被 block 且后续的脚本也不再执行。我们可以通过以下几个方式来解决这个问题：</p><h3 id="使用自定义的-gettemplate-方法"><a aria-hidden="true" tabindex="-1" href="/qiankun/zh/faq#使用自定义的-gettemplate-方法"><span class="icon icon-link"></span></a>使用自定义的 getTemplate 方法</h3><p>通过自己实现的 getTemplate 方法过滤微应用 HTML 模板中的异常脚本</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports punctuation">{</span><span class="token imports"> start </span><span class="token imports punctuation">}</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&#x27;qiankun&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">getTemplate</span><span class="token punctuation">(</span><span class="token parameter">tpl</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">return</span><span class="token plain"> tpl</span><span class="token punctuation">.</span><span class="token method function property-access">replace</span><span class="token punctuation">(</span><span class="token string">&#x27;&lt;script src=&quot;/to-be-replaced.js&quot;&gt;&lt;script&gt;&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><h3 id="使用自定义的-fetch-方法"><a aria-hidden="true" tabindex="-1" href="/qiankun/zh/faq#使用自定义的-fetch-方法"><span class="icon icon-link"></span></a>使用自定义的 fetch 方法</h3><p>通过自己实现的 fetch 方法拦截有问题的脚本</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports punctuation">{</span><span class="token imports"> start </span><span class="token imports punctuation">}</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&#x27;qiankun&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token parameter punctuation">,</span><span class="token parameter"> </span><span class="token parameter operator">...</span><span class="token parameter">args</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">url </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string">&#x27;http://to-be-replaced.js&#x27;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">async</span><span class="token plain"> </span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token string">&#x27;&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">fetch</span><span class="token punctuation">(</span><span class="token plain">url</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token spread operator">...</span><span class="token plain">args</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><h3 id="将微应用的-html-的-response-content-type-改为-textplain（终极方案）"><a aria-hidden="true" tabindex="-1" href="/qiankun/zh/faq#将微应用的-html-的-response-content-type-改为-textplain（终极方案）"><span class="icon icon-link"></span></a>将微应用的 HTML 的 response content-type 改为 text/plain（终极方案）</h3><p>原理是运营商只能识别 response content-type 为 text/html 的请求并插入脚本，text/plain 类型的响应则不会被劫持。</p><p>修改微应用 HTML 的 content-type 方法可以自行 google，也有一个更简单高效的方案：</p><ol><li><p>微应用发布时从 index.html 复制出一个 index.txt 文件出来</p></li><li><p>将主应用中的 entry 改为 txt 地址，如：</p><div class="__dumi-default-code-block"><pre class="prism-code language-diff"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">registerMicroApps(</span></div><div class="token-line"><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line"> [</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted">-</span><span class="token deleted-sign deleted line">    { name: &#x27;app1&#x27;, entry: &#x27;//localhost:8080/index.html&#x27;, container, activeRule },</span></div><div class="token-line"><span class="token deleted-sign deleted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">    { name: &#x27;app1&#x27;, entry: &#x27;//localhost:8080/index.txt&#x27;, container, activeRule },</span></div><div class="token-line"><span class="token inserted-sign inserted line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line"> ],</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token plain">);</span></div></pre></div></li></ol><h2 id="如何确保主应用跟微应用之间的样式隔离"><a aria-hidden="true" tabindex="-1" href="/qiankun/zh/faq#如何确保主应用跟微应用之间的样式隔离"><span class="icon icon-link"></span></a>如何确保主应用跟微应用之间的样式隔离</h2><p>qiankun 将会自动隔离微应用之间的样式（开启沙箱的情况下），你可以通过手动的方式确保主应用与微应用之间的样式隔离。比如给主应用的所有样式添加一个前缀，或者假如你使用了 <a target="_blank" rel="noopener noreferrer" href="https://ant.design/">ant-design<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 这样的组件库，你可以通过<a target="_blank" rel="noopener noreferrer" href="https://ant.design/docs/react/customize-theme">这篇文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>中的配置方式给主应用样式自动添加指定的前缀。</p><p>以 antd 为例：</p><ol><li><p>配置 webpack 修改 less 变量</p><div class="__dumi-default-code-block"><pre class="prism-code language-diff"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">{</span></div><div class="token-line"><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line"> loader: &#x27;less-loader&#x27;,</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line"> options: {</span></div><div class="token-line"><span class="token inserted-sign inserted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">   modifyVars: {</span></div><div class="token-line"><span class="token inserted-sign inserted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">     &#x27;@ant-prefix&#x27;: &#x27;yourPrefix&#x27;,</span></div><div class="token-line"><span class="token inserted-sign inserted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">   },</span></div><div class="token-line"><span class="token inserted-sign inserted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">   javascriptEnabled: true,</span></div><div class="token-line"><span class="token inserted-sign inserted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line"> },</span></div><div class="token-line"><span class="token inserted-sign inserted line"></span><span class="token plain">}</span></div></pre></div></li><li><p>配置 antd <a target="_blank" rel="noopener noreferrer" href="https://ant.design/components/config-provider-cn/">ConfigProvider<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><div class="__dumi-default-code-block"><pre class="prism-code language-jsx"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> ConfigProvider </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">from</span><span class="token plain"> </span><span class="token string">&#x27;antd&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">export</span><span class="token plain"> </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token function-variable function">MyApp</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token tag punctuation">&lt;</span><span class="token tag class-name">ConfigProvider</span><span class="token tag"> </span><span class="token tag attr-name">prefixCls</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">yourPrefix</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token tag punctuation">&lt;</span><span class="token tag class-name">App</span><span class="token tag"> </span><span class="token tag punctuation">/&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token tag punctuation">&lt;/</span><span class="token tag class-name">ConfigProvider</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div></li></ol><p>详细文档参考 <a target="_blank" rel="noopener noreferrer" href="https://ant.design/docs/react/customize-theme">antd 官方指南<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p><div class="__dumi-default-alert" type="info">在最新的 qiankun 版本中，你也可以尝试通过配置 `<!-- -->{<!-- --> sandbox : <!-- -->{<!-- --> experimentalStyleIsolation: true <!-- -->}<!-- --> <!-- -->}<!-- -->` 的方式开启运行时的 scoped css 功能，从而解决应用间的样式隔离问题。 PS：目前该特性还处于实验阶段，如果碰到一些问题欢迎提 <a target="_blank" rel="noopener noreferrer" href="https://github.com/umijs/qiankun/issues/new?assignees=&amp;labels=&amp;template=bug_report_cn.md&amp;title=%5BBug%5D%E8%AF%B7%E9%81%B5%E5%BE%AA%E4%B8%8B%E6%96%87%E6%A8%A1%E6%9D%BF%E6%8F%90%E4%BA%A4%E9%97%AE%E9%A2%98%EF%BC%8C%E5%90%A6%E5%88%99%E6%82%A8%E7%9A%84%E9%97%AE%E9%A2%98%E4%BC%9A%E8%A2%AB%E5%85%B3%E9%97%AD">issue<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 来帮助我们一起改善。</div><h2 id="如何独立运行微应用？"><a aria-hidden="true" tabindex="-1" href="/qiankun/zh/faq#如何独立运行微应用？"><span class="icon icon-link"></span></a>如何独立运行微应用？</h2><p>有些时候我们希望直接启动微应用从而更方便的开发调试，你可以使用这个全局变量来区分当前是否运行在 qiankun 的主应用的上下文中：</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">__POWERED_BY_QIANKUN__</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">export</span><span class="token plain"> </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token function-variable function">mount</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">async</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><h2 id="如何同时激活两个微应用？"><a aria-hidden="true" tabindex="-1" href="/qiankun/zh/faq#如何同时激活两个微应用？"><span class="icon icon-link"></span></a>如何同时激活两个微应用？</h2><p>微应用何时被激活完全取决于你的 <code>activeRule</code> 配置，比如下面的例子里，我们将 <code>reactApp</code> 和 <code>react15App</code> 的 <code>activeRule</code> 逻辑设置成一致的：</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token function">registerMicroApps</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"> name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;reactApp&#x27;</span><span class="token punctuation">,</span><span class="token plain"> entry</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;//localhost:7100&#x27;</span><span class="token punctuation">,</span><span class="token plain"> container</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token function-variable function">activeRule</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token function">isReactApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"> name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;react15App&#x27;</span><span class="token punctuation">,</span><span class="token plain"> entry</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;//localhost:7102&#x27;</span><span class="token punctuation">,</span><span class="token plain"> container</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token function-variable function">activeRule</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token function">isReactApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"> name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;vueApp&#x27;</span><span class="token punctuation">,</span><span class="token plain"> entry</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;//localhost:7101&#x27;</span><span class="token punctuation">,</span><span class="token plain"> container</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token function-variable function">activeRule</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token function">isVueApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> singular</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>当在 <code>start</code> 方法中配置好 <code>singular: false</code> 后，只要 <code>isReactApp()</code> 返回 <code>true</code> 时，<code>reactApp</code> 和 <code>react15App</code> 将会同时被 mount。</p><div class="__dumi-default-alert">页面上不能同时显示多个依赖于路由的微应用，因为浏览器只有一个 url，如果有多个依赖路由的微应用同时被激活，那么必定会导致其中一个 404。</div><h2 id="如何提取出公共的依赖库？"><a aria-hidden="true" tabindex="-1" href="/qiankun/zh/faq#如何提取出公共的依赖库？"><span class="icon icon-link"></span></a>如何提取出公共的依赖库？</h2><blockquote><p>不要共享运行时，即便所有的团队都是用同一个框架。- <a target="_blank" rel="noopener noreferrer" href="https://micro-frontends.org/">微前端<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote><p>虽然共享依赖并不建议，但如果你真的有这个需求，你可以在微应用中将公共依赖配置成 <code>external</code>，然后在主应用中导入这些公共依赖。</p><p>qiankun 2.0 版本将提供一种更智能的方式使其自动化。</p><h2 id="qiankun-能兼容-ie-吗？"><a aria-hidden="true" tabindex="-1" href="/qiankun/zh/faq#qiankun-能兼容-ie-吗？"><span class="icon icon-link"></span></a>qiankun 能兼容 ie 吗？</h2><blockquote><p>兼容.</p></blockquote><p>但是 IE 环境下（不支持 Proxy 的浏览器）只能使用单实例模式，qiankun 会自动将 <code>singular</code> 配置为 <code>true</code>。</p><p>你可以在<a href="/qiankun/zh/api#startopts">这里</a>找到 singular 相关说明。</p><h3 id="如何给-ie-打补丁？"><a aria-hidden="true" tabindex="-1" href="/qiankun/zh/faq#如何给-ie-打补丁？"><span class="icon icon-link"></span></a>如何给 ie 打补丁？</h3><p>如果希望 qiankun （或其依赖库、或者您的应用本身）在 IE 下正常运行，你<strong>至少</strong>需要在应用入口引入以下这些 polyfills：</p><div class="__dumi-default-alert" type="info">什么是 <a target="_blank" rel="noopener noreferrer" href="https://developer.mozilla.org/zh-CN/docs/Glossary/Polyfill">polyfill<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="__dumi-default-code-block"><pre class="prism-code language-javascript"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword module">import</span><span class="token plain"> </span><span class="token string">&#x27;whatwg-fetch&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token string">&#x27;custom-event-polyfill&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token string">&#x27;core-js/stable/promise&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token string">&#x27;core-js/stable/symbol&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token string">&#x27;core-js/stable/string/starts-with&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token string">&#x27;core-js/web/url&#x27;</span><span class="token punctuation">;</span></div></pre></div><p><strong>通常我们建议您直接使用 @babel/preset-env 插件完成自动引入 IE 需要的 polyfill 的能力，所有的操作文档您都可以在 <a target="_blank" rel="noopener noreferrer" href="https://babeljs.io/docs/en/babel-preset-env">babel 官方文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 找到。</strong></p><div class="__dumi-default-alert" type="info">您也可以查看<a target="_blank" rel="noopener noreferrer" href="https://www.yuque.com/kuitos/gky7yw/qskte2">这篇文章<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>来获取更多 IE 兼容相关的知识。</div><h2 id="报错-here-is-no-fetch-on-the-window-env-you-need-to-polyfill-it"><a aria-hidden="true" tabindex="-1" href="/qiankun/zh/faq#报错-here-is-no-fetch-on-the-window-env-you-need-to-polyfill-it"><span class="icon icon-link"></span></a>报错 <code>Here is no &quot;fetch&quot; on the window env, you need to polyfill it</code></h2><p>qiankun 依赖的 import-html-entry 通过 <code>window.fetch</code> 来获取微应用的资源， 部分<a target="_blank" rel="noopener noreferrer" href="https://caniuse.com/#search=fetch">不支持 fetch 的浏览器<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>需要在入口处打上相应的 <a target="_blank" rel="noopener noreferrer" href="https://github.com/github/fetch">polyfill<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><h2 id="微应用-jsonp-跨域错误怎么处理？"><a aria-hidden="true" tabindex="-1" href="/qiankun/zh/faq#微应用-jsonp-跨域错误怎么处理？"><span class="icon icon-link"></span></a>微应用 JSONP 跨域错误怎么处理？</h2><p>qiankun 会将微应用的动态 script 加载（例如 JSONP）转化为 fetch 请求，因此需要相应的后端服务支持跨域，否则会导致错误。</p><p>在单实例模式下，你可以使用 <code>excludeAssetFilter</code> 参数来放行这部分资源请求，但是注意，被该选项放行的资源会逃逸出沙箱，由此带来的副作用需要你自行处理。</p><p>若在多实例模式下使用 JSONP，单纯使用 <code>excludeAssetFilter</code> 并不能取得好的效果，因为各应用被沙箱所隔离；你可以在主应用提供统一的 JSONP 工具，微应用调用主应用提供的该工具来曲线救国。</p><h2 id="微应用路径下刷新后-404？"><a aria-hidden="true" tabindex="-1" href="/qiankun/zh/faq#微应用路径下刷新后-404？"><span class="icon icon-link"></span></a>微应用路径下刷新后 404？</h2><p>通常是因为你使用的是 browser 模式的路由，这种路由模式的开启需要服务端配合才行。具体配置方式参考：</p><ul><li><a target="_blank" rel="noopener noreferrer" href="https://router.vuejs.org/zh/guide/essentials/history-mode.html">HTML5 History 模式<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://react-guide.github.io/react-router-cn/docs/guides/basics/Histories.html#browserHistory">browserHistory<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul><h2 id="主应用如何配置-404-页面？"><a aria-hidden="true" tabindex="-1" href="/qiankun/zh/faq#主应用如何配置-404-页面？"><span class="icon icon-link"></span></a>主应用如何配置 404 页面？</h2><p>首先不应该写通配符 <code>*</code> ，可以将 404 页面注册为一个普通路由页面，比如说 <code>/404</code> ，然后在主应用的路由钩子函数里面判断一下，如果既不是主应用路由，也不是微应用，就跳转到 404 页面。</p><p>以<code>vue-router</code>为例，伪代码如下：</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> childrenPath </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token string">&#x27;/app1&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;/app2&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">router</span><span class="token punctuation">.</span><span class="token method function property-access">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">to</span><span class="token parameter punctuation">,</span><span class="token parameter"> </span><span class="token parameter keyword module">from</span><span class="token parameter punctuation">,</span><span class="token parameter"> next</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">to</span><span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// 有 name 属性，说明是主应用的路由</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">childrenPath</span><span class="token punctuation">.</span><span class="token method function property-access">some</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> to</span><span class="token punctuation">.</span><span class="token property-access">path</span><span class="token punctuation">.</span><span class="token method function property-access">includes</span><span class="token punctuation">(</span><span class="token plain">item</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;404&#x27;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><h2 id="微应用之间如何跳转？"><a aria-hidden="true" tabindex="-1" href="/qiankun/zh/faq#微应用之间如何跳转？"><span class="icon icon-link"></span></a>微应用之间如何跳转？</h2><ul><li><p>主应用和微应用都是 <code>hash</code> 模式，主应用根据 <code>hash</code> 来判断微应用，则不用考虑这个问题。</p></li><li><p>主应用根据 <code>path</code> 来判断微应用</p><p><code>history</code> 模式的微应用之间的跳转，或者微应用跳主应用页面，直接使用微应用的路由实例是不行的，原因是微应用的路由实例跳转都基于路由的 <code>base</code>。有两种办法可以跳转：</p><ol><li><code>history.pushState()</code>：<a target="_blank" rel="noopener noreferrer" href="https://developer.mozilla.org/zh-CN/docs/Web/API/History/pushState">mdn 用法介绍<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li>将主应用的路由实例通过 <code>props</code> 传给微应用，微应用这个路由实例跳转。</li></ol></li></ul><h2 id="微应用文件更新之后，访问的还是旧版文件"><a aria-hidden="true" tabindex="-1" href="/qiankun/zh/faq#微应用文件更新之后，访问的还是旧版文件"><span class="icon icon-link"></span></a>微应用文件更新之后，访问的还是旧版文件</h2><p>服务器需要给微应用的 <code>index.html</code> 配置一个响应头：<code>Cache-Control no-cache</code>，意思就是每次请求都检查是否更新。</p><p>以 <code>Nginx</code> 为例:</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">location = /index.html {</span></div><div class="token-line"><span class="token plain">  add_header Cache-Control no-cache;</span></div><div class="token-line"><span class="token plain">}</span></div></pre></div><h2 id="使用-config-entry-时微应用样式丢失"><a aria-hidden="true" tabindex="-1" href="/qiankun/zh/faq#使用-config-entry-时微应用样式丢失"><span class="icon icon-link"></span></a>使用 config entry 时微应用样式丢失</h2><p>有些场景下我们会使用 config entry 的方式加载微应用（<strong>不推荐</strong>）：</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token function">loadMicroApp</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;configEntry&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  entry</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    scripts</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token string">&#x27;//t.com/t.js&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    styles</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token string">&#x27;//t.com/t.css&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>微应用的 entry js 由于没有附属的 html，mount 钩子直接这么写的：</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword">async</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token maybe-class-name">ReactDOM</span><span class="token punctuation">.</span><span class="token method function property-access">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token maybe-class-name">App</span><span class="token plain"> </span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span><span class="token plain"> props</span><span class="token punctuation">.</span><span class="token property-access">container</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>因为 <code>props.container</code> 并不是一个空的容器，里面会包含微应用通过 styles 配置注册进来的样式表等信息，所以当我们直接以<code>props.container</code> 为 react 应用的容器渲染时，会把容器里原来的所有 dom 结构全部覆盖掉，从而导致样式表丢失。</p><p>我们需要给使用 config entry 的微应用构造一个空的渲染容器，专门用来挂载 react 应用：</p><div class="__dumi-default-code-block"><pre class="prism-code language-diff"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">loadMicroApp({</span></div><div class="token-line"><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line"> name: &#x27;configEntry&#x27;,</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line"> entry: {</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">   html: &#x27;&lt;div id=&quot;root&quot;&gt;&lt;/div&gt;&#x27;,</span></div><div class="token-line"><span class="token inserted-sign inserted line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   scripts: [&#x27;//t.com/t.js&#x27;],</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   styles: [&#x27;//t.com/t.css&#x27;]</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line"> }</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token plain">});</span></div></pre></div><p>mount 钩子里不是直接渲染到 <code>props.container</code> ，而是渲染到其 <code>root</code> 节点里：</p><div class="__dumi-default-code-block"><pre class="prism-code language-diff"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">export async function mount(props) {</span></div><div class="token-line"><span class="token plain"></span><span class="token deleted-sign deleted prefix deleted">-</span><span class="token deleted-sign deleted line"> ReactDOM.render(&lt;App/&gt;, props.container);</span></div><div class="token-line"><span class="token deleted-sign deleted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line"> ReactDOM.render(&lt;App/&gt;, props.container.querySelector(&#x27;#root&#x27;));</span></div><div class="token-line"><span class="token inserted-sign inserted line"></span><span class="token plain">}</span></div></pre></div><h2 id="如何解决拉取微应用-entry-时-cookie-未携带的问题"><a aria-hidden="true" tabindex="-1" href="/qiankun/zh/faq#如何解决拉取微应用-entry-时-cookie-未携带的问题"><span class="icon icon-link"></span></a>如何解决拉取微应用 entry 时 cookie 未携带的问题</h2><p>因为拉取微应用 entry 的请求都是跨域的，所以当你的微应用是依赖 cookie (如登陆鉴权)的情况下，你需要通过自定义 fetch 的方式，开启 fetch 的 cors 模式：</p><ul><li><p>如果你是通过 <a href="/qiankun/zh/api#registermicroappsapps-lifecycles">registerMicroApps</a> 加载微应用的，你需要在 start 方法里配置自定义 fetch，如：</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports punctuation">{</span><span class="token imports"> start </span><span class="token imports punctuation">}</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&#x27;qiankun&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token parameter punctuation">,</span><span class="token parameter"> </span><span class="token parameter operator">...</span><span class="token parameter">args</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// 给指定的微应用 entry 开启跨域请求</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">url </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string">&#x27;http://app.alipay.com/entry.html&#x27;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">fetch</span><span class="token punctuation">(</span><span class="token plain">url</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token spread operator">...</span><span class="token plain">args</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        mode</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;cors&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        credentials</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;include&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">fetch</span><span class="token punctuation">(</span><span class="token plain">url</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token spread operator">...</span><span class="token plain">args</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div></li><li><p>如果你是通过 <a href="/qiankun/zh/api#loadmicroappapp-configuration">loadMicroApp</a> 加载微应用的，你需要在调用时配置自定义 fetch，如：</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports punctuation">{</span><span class="token imports"> loadMicroApp </span><span class="token imports punctuation">}</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&#x27;qiankun&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token function">loadMicroApp</span><span class="token punctuation">(</span><span class="token plain">app</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token parameter punctuation">,</span><span class="token parameter"> </span><span class="token parameter operator">...</span><span class="token parameter">args</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// 给指定的微应用 entry 开启跨域请求</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">url </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string">&#x27;http://app.alipay.com/entry.html&#x27;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">fetch</span><span class="token punctuation">(</span><span class="token plain">url</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token spread operator">...</span><span class="token plain">args</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        mode</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;cors&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        credentials</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;include&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">fetch</span><span class="token punctuation">(</span><span class="token plain">url</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token spread operator">...</span><span class="token plain">args</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div></li><li><p>如果你是通过 <a target="_blank" rel="noopener noreferrer" href="https://umijs.org/zh-CN/plugins/plugin-qiankun">umi plugin<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 来使用 qiankun 的，那么你只需要给对应的微应用开启 credentials 配置即可：</p><div class="__dumi-default-code-block"><pre class="prism-code language-diff"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">export default {</span></div><div class="token-line"><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line"> qiankun: {</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   master: {</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">     apps: [</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">       {</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">         name: &#x27;app&#x27;,</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">         entry: &#x27;//app.alipay.com/entry.html&#x27;,</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">         credentials: true,</span></div><div class="token-line"><span class="token inserted-sign inserted line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">       }</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">     ]</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   }</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line"> }</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token plain">}</span></div></pre></div></li></ul></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/kuitos/qiankun/edit/master/docs/faq/README.zh.md">在 GitHub 上编辑此页<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="最后更新时间：">7/27/2021 13:14:42</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script>
      (function () {
        if (!location.port) {
          (function (i, s, o, g, r, a, m) {
            i["GoogleAnalyticsObject"] = r;
            (i[r] =
              i[r] ||
              function () {
                (i[r].q = i[r].q || []).push(arguments);
              }),
              (i[r].l = 1 * new Date());
            (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m);
          })(
            window,
            document,
            "script",
            "//www.google-analytics.com/analytics.js",
            "ga"
          );
          ga("create", "UA-157295698-1", "auto");
          ga("send", "pageview");
        }
      })();
    </script>
    <script src="/qiankun/umi.2968c678.js"></script>
  </body>
</html>
