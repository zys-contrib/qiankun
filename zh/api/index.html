<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <meta
      name="keywords"
      content="microfrontend, micro frontend, micro frontends, micro-frontend, micro-frontends, microservice, javascript"
    />
    <link
      rel="shortcut icon"
      type="image/x-icon"
      href="https://gw.alipayobjects.com/mdn/rms_655822/afts/img/A*4sIUQpcos_gAAAAAAAAAAAAAARQnAQ"
    />
    <style>
      html .__dumi-default-layout-hero {
        padding: 140px 0;
        background: #21144d no-repeat bottom/cover
          url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1600 900'%3E%3Cpolygon fill='%23f3c200' points='957 450 539 900 1396 900'/%3E%3Cpolygon fill='%23e26003' points='957 450 872.9 900 1396 900'/%3E%3Cpolygon fill='%23ecb500' points='-60 900 398 662 816 900'/%3E%3Cpolygon fill='%23d86200' points='337 900 398 662 816 900'/%3E%3Cpolygon fill='%23e4a800' points='1203 546 1552 900 876 900'/%3E%3Cpolygon fill='%23ce6400' points='1203 546 1552 900 1162 900'/%3E%3Cpolygon fill='%23dc9b00' points='641 695 886 900 367 900'/%3E%3Cpolygon fill='%23c46500' points='587 900 641 695 886 900'/%3E%3Cpolygon fill='%23d38f00' points='1710 900 1401 632 1096 900'/%3E%3Cpolygon fill='%23ba6600' points='1710 900 1401 632 1365 900'/%3E%3Cpolygon fill='%23ca8300' points='1210 900 971 687 725 900'/%3E%3Cpolygon fill='%23b16600' points='943 900 1210 900 971 687'/%3E%3C/svg%3E");
      }
      html .__dumi-default-layout-hero h1 {
        color: #f3f3f3;
        text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
      }
      html .__dumi-default-layout-hero .markdown {
        color: #eee;
        text-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
      }
    </style>
    <link rel="stylesheet" href="/qiankun/umi.fef85f5f.css" />
    <script>
      window.routerBase = "/qiankun";
    </script>
    <script>
      //! umi version: 3.5.14
    </script>
    <script>
      !(function () {
        var e = localStorage.getItem("dumi:prefers-color"),
          t = window.matchMedia("(prefers-color-scheme: dark)").matches,
          r = ["light", "dark", "auto"];
        document.documentElement.setAttribute(
          "data-prefers-color",
          e === r[2] ? (t ? r[1] : r[0]) : r.includes(e) ? e : r[0]
        );
      })();
    </script>
    <script>
      var _hmt = _hmt || [];
    </script>
    <script>
      (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?0f738d9b0ac90574c09183ea85bcfa2e";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
      })();
    </script>
    <title>API 说明</title>
  </head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-route="/zh/api" data-show-sidemenu="true" data-show-slugs="false" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;https://gw.alipayobjects.com/zos/bmw-prod/8a74c1d3-16f3-4719-be63-15e467a68a24/km0cv8vn_w500_h500.png&#x27;)" href="/qiankun/zh">qiankun</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><span><a href="/qiankun/zh/guide">指南</a></span><span><a aria-current="page" class="active" href="/qiankun/zh/api">API</a></span><span><a href="/qiankun/zh/faq">常见问题</a></span><span><a href="/qiankun/zh/cookbook">入门教程</a></span><span>版本公告<ul><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/umijs/qiankun/releases">发布日志<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a href="/qiankun/zh/cookbook#从-1x-版本升级到-2x-版本">升级指南</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://v1.qiankun.umijs.org/zh/">1.x 版本<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></span><span><a target="_blank" rel="noopener noreferrer" href="https://github.com/umijs/qiankun">GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></span><div class="__dumi-default-locale-select" data-locale-count="2"><a href="/qiankun/api">English</a></div><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "></div></div></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;https://gw.alipayobjects.com/zos/bmw-prod/8a74c1d3-16f3-4719-be63-15e467a68a24/km0cv8vn_w500_h500.png&#x27;)" href="/qiankun/zh"></a><h1>qiankun</h1><p></p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li><a href="/qiankun/zh/guide">指南</a></li><li><a aria-current="page" class="active" href="/qiankun/zh/api">API</a></li><li><a href="/qiankun/zh/faq">常见问题</a></li><li><a href="/qiankun/zh/cookbook">入门教程</a></li><li>版本公告<ul><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/umijs/qiankun/releases">发布日志<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a href="/qiankun/zh/cookbook#从-1x-版本升级到-2x-版本">升级指南</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://v1.qiankun.umijs.org/zh/">1.x 版本<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/umijs/qiankun">GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul><div class="__dumi-default-locale-select" data-locale-count="2"><a href="/qiankun/api">English</a></div><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "><button title="Dark theme" class="__dumi-default-dark-moon "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3854" width="22" height="22"><path d="M991.816611 674.909091a69.166545 69.166545 0 0 0-51.665455-23.272727 70.795636 70.795636 0 0 0-27.438545 5.585454A415.674182 415.674182 0 0 1 754.993338 698.181818c-209.594182 0-393.472-184.785455-393.472-395.636363 0-52.363636 38.539636-119.621818 69.515637-173.614546 4.887273-8.610909 9.634909-16.756364 14.103272-24.901818A69.818182 69.818182 0 0 0 384.631156 0a70.842182 70.842182 0 0 0-27.438545 5.585455C161.678429 90.298182 14.362065 307.898182 14.362065 512c0 282.298182 238.824727 512 532.38691 512a522.286545 522.286545 0 0 0 453.957818-268.334545A69.818182 69.818182 0 0 0 991.816611 674.909091zM546.679156 954.181818c-248.785455 0-462.941091-192-462.941091-442.181818 0-186.647273 140.637091-372.829091 300.939637-442.181818-36.817455 65.629091-92.578909 151.970909-92.578909 232.727273 0 250.181818 214.109091 465.454545 462.917818 465.454545a488.331636 488.331636 0 0 0 185.181091-46.545455 453.003636 453.003636 0 0 1-393.565091 232.727273z m103.656728-669.323636l-14.266182 83.781818a34.909091 34.909091 0 0 0 50.362182 36.770909l74.775272-39.563636 74.752 39.563636a36.142545 36.142545 0 0 0 16.174546 3.956364 34.909091 34.909091 0 0 0 34.210909-40.727273l-14.289455-83.781818 60.509091-59.345455a35.025455 35.025455 0 0 0-19.223272-59.578182l-83.61891-12.101818-37.376-76.101818a34.56 34.56 0 0 0-62.254545 0l-37.376 76.101818-83.618909 12.101818a34.909091 34.909091 0 0 0-19.246546 59.578182z m70.423272-64.698182a34.280727 34.280727 0 0 0 26.135273-19.083636l14.312727-29.090909 14.336 29.090909a34.257455 34.257455 0 0 0 26.135273 19.083636l32.046546 4.887273-23.272728 22.574545a35.234909 35.234909 0 0 0-10.007272 30.952727l5.46909 32.116364-28.625454-15.127273a34.490182 34.490182 0 0 0-32.302546 0l-28.695272 15.127273 5.469091-32.116364a35.141818 35.141818 0 0 0-9.984-30.952727l-23.272728-22.574545z" p-id="3855"></path></svg></button><button title="Light theme" class="__dumi-default-dark-sun "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4026" width="22" height="22"><path d="M915.2 476.16h-43.968c-24.704 0-44.736 16-44.736 35.84s20.032 35.904 44.736 35.904H915.2c24.768 0 44.8-16.064 44.8-35.904s-20.032-35.84-44.8-35.84zM512 265.6c-136.704 0-246.464 109.824-246.464 246.4 0 136.704 109.76 246.464 246.464 246.464S758.4 648.704 758.4 512c0-136.576-109.696-246.4-246.4-246.4z m0 425.6c-99.008 0-179.2-80.128-179.2-179.2 0-98.944 80.192-179.2 179.2-179.2S691.2 413.056 691.2 512c0 99.072-80.192 179.2-179.2 179.2zM197.44 512c0-19.84-19.136-35.84-43.904-35.84H108.8c-24.768 0-44.8 16-44.8 35.84s20.032 35.904 44.8 35.904h44.736c24.768 0 43.904-16.064 43.904-35.904zM512 198.464c19.776 0 35.84-20.032 35.84-44.8v-44.8C547.84 84.032 531.84 64 512 64s-35.904 20.032-35.904 44.8v44.8c0 24.768 16.128 44.864 35.904 44.864z m0 627.136c-19.776 0-35.904 20.032-35.904 44.8v44.736C476.096 940.032 492.16 960 512 960s35.84-20.032 35.84-44.8v-44.736c0-24.768-16.064-44.864-35.84-44.864z m329.92-592.832c17.472-17.536 20.288-43.072 6.4-57.024-14.016-14.016-39.488-11.2-57.024 6.336-4.736 4.864-26.496 26.496-31.36 31.36-17.472 17.472-20.288 43.008-6.336 57.024 13.952 14.016 39.488 11.2 57.024-6.336 4.8-4.864 26.496-26.56 31.296-31.36zM213.376 759.936c-4.864 4.8-26.56 26.624-31.36 31.36-17.472 17.472-20.288 42.944-6.4 56.96 14.016 13.952 39.552 11.2 57.024-6.336 4.8-4.736 26.56-26.496 31.36-31.36 17.472-17.472 20.288-43.008 6.336-56.96-14.016-13.952-39.552-11.072-56.96 6.336z m19.328-577.92c-17.536-17.536-43.008-20.352-57.024-6.336-14.08 14.016-11.136 39.488 6.336 57.024 4.864 4.864 26.496 26.56 31.36 31.424 17.536 17.408 43.008 20.288 56.96 6.336 14.016-14.016 11.264-39.488-6.336-57.024-4.736-4.864-26.496-26.56-31.296-31.424z m527.168 628.608c4.864 4.864 26.624 26.624 31.36 31.424 17.536 17.408 43.072 20.224 57.088 6.336 13.952-14.016 11.072-39.552-6.4-57.024-4.864-4.8-26.56-26.496-31.36-31.36-17.472-17.408-43.072-20.288-57.024-6.336-13.952 14.016-11.008 39.488 6.336 56.96z" p-id="4027"></path></svg></button><button title="Default to system" class="__dumi-default-dark-auto "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="11002" width="22" height="22"><path d="M127.658667 492.885333c0-51.882667 10.24-101.717333 30.378666-149.162666s47.786667-88.064 81.92-122.538667 75.093333-61.781333 122.538667-81.92 96.938667-30.378667 149.162667-30.378667 101.717333 10.24 149.162666 30.378667 88.405333 47.786667 122.88 81.92 61.781333 75.093333 81.92 122.538667 30.378667 96.938667 30.378667 149.162666-10.24 101.717333-30.378667 149.162667-47.786667 88.405333-81.92 122.88-75.093333 61.781333-122.88 81.92-97.28 30.378667-149.162666 30.378667-101.717333-10.24-149.162667-30.378667-88.064-47.786667-122.538667-81.92-61.781333-75.093333-81.92-122.88-30.378667-96.938667-30.378666-149.162667z m329.045333 0c0 130.048 13.994667 244.394667 41.984 343.381334h12.970667c46.762667 0 91.136-9.216 133.461333-27.306667s78.848-42.666667 109.568-73.386667 54.954667-67.242667 73.386667-109.568 27.306667-86.698667 27.306666-133.461333c0-46.421333-9.216-90.794667-27.306666-133.12s-42.666667-78.848-73.386667-109.568-67.242667-54.954667-109.568-73.386667-86.698667-27.306667-133.461333-27.306666h-11.605334c-28.672 123.562667-43.349333 237.909333-43.349333 343.722666z" p-id="11003"></path></svg></button></div></div></div><ul class="__dumi-default-menu-list"><li><a aria-current="page" class="active" href="/qiankun/zh/api">API 说明</a><ul role="slug-list"><li title="基于路由配置" data-depth="2"><a href="/qiankun/zh/api#基于路由配置"><span>基于路由配置</span></a></li><li title="registerMicroApps(apps, lifeCycles?)" data-depth="3"><a href="/qiankun/zh/api#registermicroappsapps-lifecycles"><span>registerMicroApps(apps, lifeCycles?)</span></a></li><li title="start(opts?)" data-depth="3"><a href="/qiankun/zh/api#startopts"><span>start(opts?)</span></a></li><li title="setDefaultMountApp(appLink)" data-depth="3"><a href="/qiankun/zh/api#setdefaultmountappapplink"><span>setDefaultMountApp(appLink)</span></a></li><li title="runAfterFirstMounted(effect)" data-depth="3"><a href="/qiankun/zh/api#runafterfirstmountedeffect"><span>runAfterFirstMounted(effect)</span></a></li><li title="手动加载微应用" data-depth="2"><a href="/qiankun/zh/api#手动加载微应用"><span>手动加载微应用</span></a></li><li title="loadMicroApp(app, configuration?)" data-depth="3"><a href="/qiankun/zh/api#loadmicroappapp-configuration"><span>loadMicroApp(app, configuration?)</span></a></li><li title="prefetchApps(apps, importEntryOpts?)" data-depth="3"><a href="/qiankun/zh/api#prefetchappsapps-importentryopts"><span>prefetchApps(apps, importEntryOpts?)</span></a></li><li title="addErrorHandler/removeErrorHandler" data-depth="2"><a href="/qiankun/zh/api#adderrorhandlerremoveerrorhandler"><span>addErrorHandler/removeErrorHandler</span></a></li><li title="addGlobalUncaughtErrorHandler(handler)" data-depth="2"><a href="/qiankun/zh/api#addglobaluncaughterrorhandlerhandler"><span>addGlobalUncaughtErrorHandler(handler)</span></a></li><li title="removeGlobalUncaughtErrorHandler(handler)" data-depth="2"><a href="/qiankun/zh/api#removeglobaluncaughterrorhandlerhandler"><span>removeGlobalUncaughtErrorHandler(handler)</span></a></li><li title="initGlobalState(state)" data-depth="2"><a href="/qiankun/zh/api#initglobalstatestate"><span>initGlobalState(state)</span></a></li></ul></li></ul></div></div><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="api-说明"><a aria-hidden="true" tabindex="-1" href="/qiankun/zh/api#api-说明"><span class="icon icon-link"></span></a>API 说明</h1><h2 id="基于路由配置"><a aria-hidden="true" tabindex="-1" href="/qiankun/zh/api#基于路由配置"><span class="icon icon-link"></span></a>基于路由配置</h2><p>适用于 route-based 场景。</p><p>通过将微应用关联到一些 url 规则的方式，实现当浏览器 url 发生变化时，自动加载相应的微应用的功能。</p><h3 id="registermicroappsapps-lifecycles"><a aria-hidden="true" tabindex="-1" href="/qiankun/zh/api#registermicroappsapps-lifecycles"><span class="icon icon-link"></span></a>registerMicroApps(apps, lifeCycles?)</h3><ul><li><p>参数</p><ul><li>apps - <code>Array&lt;RegistrableApp&gt;</code> - 必选，微应用的一些注册信息</li><li>lifeCycles - <code>LifeCycles</code> - 可选，全局的微应用生命周期钩子</li></ul></li><li><p>类型</p><ul><li><p><code>RegistrableApp</code></p><ul><li><p>name - <code>string</code> - 必选，微应用的名称，微应用之间必须确保唯一。</p></li><li><p>entry - <code>string | <!-- -->{<!-- --> scripts?: string[]; styles?: string[]; html?: string <!-- -->}</code> - 必选，微应用的入口。</p><ul><li>配置为字符串时，表示微应用的访问地址，例如 <code>https://qiankun.umijs.org/guide/</code>。</li><li>配置为对象时，<code>html</code> 的值是微应用的 html 内容字符串，而不是微应用的访问地址。微应用的 <code>publicPath</code> 将会被设置为 <code>/</code>。</li></ul></li><li><p>container - <code>string | HTMLElement</code> - 必选，微应用的容器节点的选择器或者 Element 实例。如<code>container: &#x27;#root&#x27;</code> 或 <code>container: document.querySelector(&#x27;#root&#x27;)</code>。</p></li><li><p>activeRule - <code>string | (location: Location) =&gt; boolean | Array&lt;string | (location: Location) =&gt; boolean&gt; </code> - 必选，微应用的激活规则。</p><ul><li>支持直接配置字符串或字符串数组，如 <code>activeRule: &#x27;/app1&#x27;</code> 或 <code>activeRule: [&#x27;/app1&#x27;, &#x27;/app2&#x27;]</code>，当配置为字符串时会直接跟 url 中的路径部分做前缀匹配，匹配成功表明当前应用会被激活。</li><li>支持配置一个 active function 函数或一组 active function。函数会传入当前 location 作为参数，函数返回 true 时表明当前微应用会被激活。如 <code>location =&gt; location.pathname.startsWith(&#x27;/app1&#x27;)</code>。</li></ul><p>规则示例：</p><p><code>&#x27;/app1&#x27;</code></p><ul><li><p>✅ <a target="_blank" rel="noopener noreferrer" href="https://app.com/app1">https://app.com/app1<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li><li><p>✅ <a target="_blank" rel="noopener noreferrer" href="https://app.com/app1/anything/everything">https://app.com/app1/anything/everything<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li><li><p>🚫 <a target="_blank" rel="noopener noreferrer" href="https://app.com/app2">https://app.com/app2<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li></ul><p><code>&#x27;/users/:userId/profile&#x27;</code></p><ul><li>✅ <a target="_blank" rel="noopener noreferrer" href="https://app.com/users/123/profile">https://app.com/users/123/profile<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li>✅ <a target="_blank" rel="noopener noreferrer" href="https://app.com/users/123/profile/sub-profile/">https://app.com/users/123/profile/sub-profile/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li>🚫 <a target="_blank" rel="noopener noreferrer" href="https://app.com/users//profile/sub-profile/">https://app.com/users//profile/sub-profile/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li>🚫 <a target="_blank" rel="noopener noreferrer" href="https://app.com/users/profile/sub-profile/">https://app.com/users/profile/sub-profile/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul><p><code>&#x27;/pathname/#/hash&#x27;</code></p><ul><li>✅ <a target="_blank" rel="noopener noreferrer" href="https://app.com/pathname/#/hash">https://app.com/pathname/#/hash<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li>✅ <a target="_blank" rel="noopener noreferrer" href="https://app.com/pathname/#/hash/route/nested">https://app.com/pathname/#/hash/route/nested<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li>🚫 <a target="_blank" rel="noopener noreferrer" href="https://app.com/pathname#/hash/route/nested">https://app.com/pathname#/hash/route/nested<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li>🚫 <a target="_blank" rel="noopener noreferrer" href="https://app.com/pathname#/another-hash">https://app.com/pathname#/another-hash<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul><p><code>[&#x27;/pathname/#/hash&#x27;, &#x27;/app1&#x27;]</code></p><ul><li>✅ <a target="_blank" rel="noopener noreferrer" href="https://app.com/pathname/#/hash/route/nested">https://app.com/pathname/#/hash/route/nested<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li>✅ <a target="_blank" rel="noopener noreferrer" href="https://app.com/app1/anything/everything">https://app.com/app1/anything/everything<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li>🚫 <a target="_blank" rel="noopener noreferrer" href="https://app.com/pathname/app1">https://app.com/pathname/app1<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li>🚫 <a target="_blank" rel="noopener noreferrer" href="https://app.com/app2">https://app.com/app2<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul><p>浏览器 url 发生变化会调用 activeRule 里的规则，<code>activeRule</code> 任意一个返回 <code>true</code> 时表明该微应用需要被激活。</p></li><li><p>loader - <code>(loading: boolean) =&gt; void</code> - 可选，loading 状态发生变化时会调用的方法。</p></li><li><p>props - <code>object</code> - 可选，主应用需要传递给微应用的数据。</p></li></ul></li><li><p><code>LifeCycles</code></p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">type</span><span class="token plain"> </span><span class="token class-name maybe-class-name">Lifecycle</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">app</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">RegistrableApp</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token known-class-name class-name">Promise</span><span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;</span><span class="token punctuation">;</span></div></pre></div><ul><li>beforeLoad - <code>Lifecycle | Array&lt;Lifecycle&gt;</code> - 可选</li><li>beforeMount - <code>Lifecycle | Array&lt;Lifecycle&gt;</code> - 可选</li><li>afterMount - <code>Lifecycle | Array&lt;Lifecycle&gt;</code> - 可选</li><li>beforeUnmount - <code>Lifecycle | Array&lt;Lifecycle&gt;</code> - 可选</li><li>afterUnmount - <code>Lifecycle | Array&lt;Lifecycle&gt;</code> - 可选</li></ul></li></ul></li><li><p>用法</p><p>注册微应用的基础配置信息。当浏览器 url 发生变化时，会自动检查每一个微应用注册的 <code>activeRule</code> 规则，符合规则的应用将会被自动激活。</p></li><li><p>示例</p><div class="__dumi-default-code-block"><pre class="prism-code language-tsx"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> registerMicroApps </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">from</span><span class="token plain"> </span><span class="token string">&#x27;qiankun&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token function">registerMicroApps</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;app1&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      entry</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;//localhost:8080&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      container</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;#container&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      activeRule</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;/react&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      props</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;kuitos&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function-variable function">beforeLoad</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">app</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;before load&#x27;</span><span class="token punctuation">,</span><span class="token plain"> app</span><span class="token punctuation">.</span><span class="token plain">name</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    beforeMount</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token parameter">app</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;before mount&#x27;</span><span class="token punctuation">,</span><span class="token plain"> app</span><span class="token punctuation">.</span><span class="token plain">name</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div></li></ul><h3 id="startopts"><a aria-hidden="true" tabindex="-1" href="/qiankun/zh/api#startopts"><span class="icon icon-link"></span></a><code>start(opts?)</code></h3><ul><li><p>参数</p><ul><li>opts - <code>Options</code> 可选</li></ul></li><li><p>类型</p><ul><li><p><code>Options</code></p><ul><li><p>prefetch - <code>boolean | &#x27;all&#x27; | string[] | (( apps: RegistrableApp[] ) =&gt; <!-- -->{<!-- --> criticalAppNames: string[]; minorAppsName: string[] <!-- -->}<!-- -->)</code> - 可选，是否开启预加载，默认为 <code>true</code>。</p><p>配置为 <code>true</code> 则会在第一个微应用 mount 完成后开始预加载其他微应用的静态资源</p><p>配置为 <code>&#x27;all&#x27;</code> 则主应用 <code>start</code> 后即开始预加载所有微应用静态资源</p><p>配置为 <code>string[]</code> 则会在第一个微应用 mounted 后开始加载数组内的微应用资源</p><p>配置为 <code>function</code> 则可完全自定义应用的资源加载时机 (首屏应用及次屏应用)</p></li><li><p>sandbox - <code>boolean</code> | <code>{<!-- --> strictStyleIsolation?: boolean, experimentalStyleIsolation?: boolean <!-- -->}</code> - 可选，是否开启沙箱，默认为 <code>true</code>。</p><p>默认情况下沙箱可以确保单实例场景子应用之间的样式隔离，但是无法确保主应用跟子应用、或者多实例场景的子应用样式隔离。当配置为 <code>{<!-- --> strictStyleIsolation: true <!-- -->}</code> 时表示开启严格的样式隔离模式。这种模式下 qiankun 会为每个微应用的容器包裹上一个 <a target="_blank" rel="noopener noreferrer" href="https://developer.mozilla.org/zh-CN/docs/Web/Web_Components/Using_shadow_DOM">shadow dom<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 节点，从而确保微应用的样式不会对全局造成影响。</p><div class="__dumi-default-alert">基于 ShadowDOM 的严格样式隔离并不是一个可以无脑使用的方案，大部分情况下都需要接入应用做一些适配后才能正常在 ShadowDOM 中运行起来（比如 react 场景下需要解决这些 <a target="_blank" rel="noopener noreferrer" href="https://github.com/facebook/react/issues/10422">问题<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，使用者需要清楚开启了 <code>strictStyleIsolation</code> 意味着什么。后续 qiankun 会提供更多官方实践文档帮助用户能快速的将应用改造成可以运行在 ShadowDOM 环境的微应用。</div><p>除此以外，qiankun 还提供了一个实验性的样式隔离特性，当 experimentalStyleIsolation 被设置为 true 时，qiankun 会改写子应用所添加的样式为所有样式规则增加一个特殊的选择器规则来限定其影响范围，因此改写后的代码会表达类似为如下结构：</p><div class="__dumi-default-code-block"><pre class="prism-code language-javascript"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment">// 假设应用名是 react16</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">.</span><span class="token property-access">app</span><span class="token operator">-</span><span class="token plain">main </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  font</span><span class="token operator">-</span><span class="token plain">size</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">14</span><span class="token plain">px</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">div</span><span class="token punctuation">[</span><span class="token plain">data</span><span class="token operator">-</span><span class="token plain">qiankun</span><span class="token operator">-</span><span class="token plain">react16</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">.</span><span class="token property-access">app</span><span class="token operator">-</span><span class="token plain">main </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  font</span><span class="token operator">-</span><span class="token plain">size</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">14</span><span class="token plain">px</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>注意: @keyframes, @font-face, @import, @page 将不被支持 (i.e. 不会被改写)</p></li><li><p>singular - <code>boolean | ((app: RegistrableApp&lt;any&gt;) =&gt; Promise&lt;boolean&gt;);</code> - 可选，是否为单实例场景，单实例指的是同一时间只会渲染一个微应用。默认为 <code>true</code>。</p></li><li><p>fetch - <code>Function</code> - 可选，自定义的 fetch 方法。</p></li><li><p>getPublicPath - <code>(entry: Entry) =&gt; string</code> - 可选，参数是微应用的 entry 值。</p></li><li><p>getTemplate - <code>(tpl: string) =&gt; string</code> - 可选。</p></li><li><p>excludeAssetFilter - <code>(assetUrl: string) =&gt; boolean</code> - 可选，指定部分特殊的动态加载的微应用资源（css/js) 不被 qiankun 劫持处理。</p></li></ul></li></ul></li><li><p>用法</p><p>启动 qiankun。</p></li><li><p>示例</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token imports punctuation">{</span><span class="token imports"> start </span><span class="token imports punctuation">}</span><span class="token plain"> </span><span class="token keyword">from</span><span class="token plain"> </span><span class="token string">&#x27;qiankun&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div></li></ul><h3 id="setdefaultmountappapplink"><a aria-hidden="true" tabindex="-1" href="/qiankun/zh/api#setdefaultmountappapplink"><span class="icon icon-link"></span></a>setDefaultMountApp(appLink)</h3><ul><li><p>参数</p><ul><li>appLink - <code>string</code> - 必选</li></ul></li><li><p>用法</p><p>设置主应用启动后默认进入的微应用。</p></li><li><p>示例</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token imports punctuation">{</span><span class="token imports"> setDefaultMountApp </span><span class="token imports punctuation">}</span><span class="token plain"> </span><span class="token keyword">from</span><span class="token plain"> </span><span class="token string">&#x27;qiankun&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token function">setDefaultMountApp</span><span class="token punctuation">(</span><span class="token string">&#x27;/homeApp&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div></li></ul><h3 id="runafterfirstmountedeffect"><a aria-hidden="true" tabindex="-1" href="/qiankun/zh/api#runafterfirstmountedeffect"><span class="icon icon-link"></span></a><code>runAfterFirstMounted(effect)</code></h3><ul><li><p>参数</p><ul><li>effect - <code>() =&gt; void</code> - 必选</li></ul></li><li><p>用法</p><p>第一个微应用 mount 后需要调用的方法，比如开启一些监控或者埋点脚本。</p></li><li><p>示例</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token imports punctuation">{</span><span class="token imports"> runAfterFirstMounted </span><span class="token imports punctuation">}</span><span class="token plain"> </span><span class="token keyword">from</span><span class="token plain"> </span><span class="token string">&#x27;qiankun&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token function">runAfterFirstMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token function">startMonitor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div></li></ul><h2 id="手动加载微应用"><a aria-hidden="true" tabindex="-1" href="/qiankun/zh/api#手动加载微应用"><span class="icon icon-link"></span></a>手动加载微应用</h2><p>适用于需要手动 加载/卸载 一个微应用的场景。</p><div class="__dumi-default-alert" type="info">通常这种场景下微应用是一个不带路由的可独立运行的业务组件。 微应用不宜拆分过细，建议按照业务域来做拆分。业务关联紧密的功能单元应该做成一个微应用，反之关联不紧密的可以考虑拆分成多个微应用。 一个判断业务关联是否紧密的标准：<strong>看这个微应用与其他微应用是否有频繁的通信需求</strong>。如果有可能说明这两个微应用本身就是服务于同一个业务场景，合并成一个微应用可能会更合适。</div><h3 id="loadmicroappapp-configuration"><a aria-hidden="true" tabindex="-1" href="/qiankun/zh/api#loadmicroappapp-configuration"><span class="icon icon-link"></span></a><code>loadMicroApp(app, configuration?)</code></h3><ul><li><p>参数</p><ul><li><p>app - <code>LoadableApp</code> - 必选，微应用的基础信息</p><ul><li>name - <code>string</code> - 必选，微应用的名称，微应用之间必须确保唯一。</li><li>entry - <code>string | <!-- -->{<!-- --> scripts?: string[]; styles?: string[]; html?: string <!-- -->}</code> - 必选，微应用的入口（详细说明同上）。</li><li>container - <code>string | HTMLElement</code> - 必选，微应用的容器节点的选择器或者 Element 实例。如<code>container: &#x27;#root&#x27;</code> 或 <code>container: document.querySelector(&#x27;#root&#x27;)</code>。</li><li>props - <code>object</code> - 可选，初始化时需要传递给微应用的数据。</li></ul></li><li><p>configuration - <code>Configuration</code> - 可选，微应用的配置信息</p><ul><li><p>sandbox - <code>boolean</code> | <code>{<!-- --> strictStyleIsolation?: boolean, experimentalStyleIsolation?: boolean <!-- -->}</code> - 可选，是否开启沙箱，默认为 <code>true</code>。</p><p>默认情况下沙箱可以确保单实例场景子应用之间的样式隔离，但是无法确保主应用跟子应用、或者多实例场景的子应用样式隔离。当配置为 <code>{<!-- --> strictStyleIsolation: true <!-- -->}</code> 时表示开启严格的样式隔离模式。这种模式下 qiankun 会为每个微应用的容器包裹上一个 <a target="_blank" rel="noopener noreferrer" href="https://developer.mozilla.org/zh-CN/docs/Web/Web_Components/Using_shadow_DOM">shadow dom<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 节点，从而确保微应用的样式不会对全局造成影响。</p><div class="__dumi-default-alert">基于 ShadowDOM 的严格样式隔离并不是一个可以无脑使用的方案，大部分情况下都需要接入应用做一些适配后才能正常在 ShadowDOM 中运行起来（比如 react 场景下需要解决这些 <a target="_blank" rel="noopener noreferrer" href="https://github.com/facebook/react/issues/10422">问题<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，使用者需要清楚开启了 <code>strictStyleIsolation</code> 意味着什么。后续 qiankun 会提供更多官方实践文档帮助用户能快速的将应用改造成可以运行在 ShadowDOM 环境的微应用。</div><p>除此以外，qiankun 还提供了一个实验性的样式隔离特性，当 experimentalStyleIsolation 被设置为 true 时，qiankun 会改写子应用所添加的样式为所有样式规则增加一个特殊的选择器规则来限定其影响范围，因此改写后的代码会表达类似为如下结构：</p><div class="__dumi-default-code-block"><pre class="prism-code language-css"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token selector">// 假设应用名是 react16</span></div><div class="token-line"><span class="token selector"></span><span class="token selector class">.app-main</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token property">font-size</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">14</span><span class="token unit">px</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token selector">div</span><span class="token selector attribute punctuation">[</span><span class="token selector attribute attr-name">data-qiankun-react16</span><span class="token selector attribute punctuation">]</span><span class="token selector"> </span><span class="token selector class">.app-main</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token property">font-size</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">14</span><span class="token unit">px</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>注意事项: 目前 @keyframes, @font-face, @import, @page 等规则不会支持 (i.e. 不会被改写)</p></li><li><p>singular - <code>boolean | ((app: RegistrableApp&lt;any&gt;) =&gt; Promise&lt;boolean&gt;);</code> - 可选，是否为单实例场景，单实例指的是同一时间只会渲染一个微应用。默认为 <code>false</code>。</p></li><li><p>fetch - <code>Function</code> - 可选，自定义的 fetch 方法。</p></li><li><p>getPublicPath - <code>(entry: Entry) =&gt; string</code> - 可选，参数是微应用的 entry 值。</p></li><li><p>getTemplate - <code>(tpl: string) =&gt; string</code> - 可选</p></li><li><p>excludeAssetFilter - <code>(assetUrl: string) =&gt; boolean</code> - 可选，指定部分特殊的动态加载的微应用资源（css/js) 不被 qiankun 劫持处理</p></li></ul></li></ul></li><li><p>返回值 - <code>MicroApp</code> - 微应用实例</p><ul><li>mount(): Promise&lt;null&gt;;</li><li>unmount(): Promise&lt;null&gt;;</li><li>update(customProps: object): Promise&lt;any&gt;;</li><li>getStatus(): | &quot;NOT_LOADED&quot; | &quot;LOADING_SOURCE_CODE&quot; | &quot;NOT_BOOTSTRAPPED&quot; | &quot;BOOTSTRAPPING&quot; | &quot;NOT_MOUNTED&quot; | &quot;MOUNTING&quot; | &quot;MOUNTED&quot; | &quot;UPDATING&quot; | &quot;UNMOUNTING&quot; | &quot;UNLOADING&quot; | &quot;SKIP_BECAUSE_BROKEN&quot; | &quot;LOAD_ERROR&quot;;</li><li>loadPromise: Promise&lt;null&gt;;</li><li>bootstrapPromise: Promise&lt;null&gt;;</li><li>mountPromise: Promise&lt;null&gt;;</li><li>unmountPromise: Promise&lt;null&gt;;</li></ul></li><li><p>用法</p><p>手动加载一个微应用。</p><p>如果需要能支持主应用手动 update 微应用，需要微应用 entry 再多导出一个 update 钩子：</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">export</span><span class="token plain"> </span><span class="token keyword">async</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token plain">props</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">renderApp</span><span class="token punctuation">(</span><span class="token plain">props</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 增加 update 钩子以便主应用手动更新微应用</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">export</span><span class="token plain"> </span><span class="token keyword">async</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">update</span><span class="token punctuation">(</span><span class="token plain">props</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">renderPatch</span><span class="token punctuation">(</span><span class="token plain">props</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div></li><li><p>示例</p><div class="__dumi-default-code-block"><pre class="prism-code language-jsx"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> loadMicroApp </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">from</span><span class="token plain"> </span><span class="token string">&#x27;qiankun&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> React </span><span class="token keyword">from</span><span class="token plain"> </span><span class="token string">&#x27;react&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">class</span><span class="token plain"> </span><span class="token class-name">App</span><span class="token plain"> </span><span class="token keyword">extends</span><span class="token plain"> </span><span class="token class-name">React</span><span class="token class-name punctuation">.</span><span class="token class-name">Component</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  containerRef </span><span class="token operator">=</span><span class="token plain"> React</span><span class="token punctuation">.</span><span class="token function">createRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  microApp </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">null</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token plain">microApp </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">loadMicroApp</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;app1&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      entry</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;//localhost:1234&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      container</span><span class="token operator">:</span><span class="token plain"> </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token plain">containerRef</span><span class="token punctuation">.</span><span class="token plain">current</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      props</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> brand</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;qiankun&#x27;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token plain">microApp</span><span class="token punctuation">.</span><span class="token function">unmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token function">componentDidUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token plain">microApp</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;kuitos&#x27;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token tag punctuation">&lt;</span><span class="token tag">div</span><span class="token tag"> </span><span class="token tag attr-name">ref</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript keyword">this</span><span class="token tag script language-javascript punctuation">.</span><span class="token tag script language-javascript">containerRef</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag punctuation">&gt;</span><span class="token tag punctuation">&lt;/</span><span class="token tag">div</span><span class="token tag punctuation">&gt;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div></li></ul><h3 id="prefetchappsapps-importentryopts"><a aria-hidden="true" tabindex="-1" href="/qiankun/zh/api#prefetchappsapps-importentryopts"><span class="icon icon-link"></span></a><code>prefetchApps(apps, importEntryOpts?)</code></h3><ul><li><p>参数</p><ul><li>apps - <code>AppMetadata[]</code> - 必选 - 预加载的应用列表</li><li>importEntryOpts - 可选 - 加载配置</li></ul></li><li><p>类型</p><ul><li><code>AppMetadata</code><ul><li>name - <code>string</code> - 必选 - 应用名</li><li>entry - <code>string | <!-- -->{<!-- --> scripts?: string[]; styles?: string[]; html?: string <!-- -->}</code> - 必选，微应用的 entry 地址</li></ul></li></ul></li><li><p>用法</p><p>手动预加载指定的微应用静态资源。仅手动加载微应用场景需要，基于路由自动激活场景直接配置 <code>prefetch</code> 属性即可。</p></li><li><p>示例</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token imports punctuation">{</span><span class="token imports"> prefetchApps </span><span class="token imports punctuation">}</span><span class="token plain"> </span><span class="token keyword">from</span><span class="token plain"> </span><span class="token string">&#x27;qiankun&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token function">prefetchApps</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"> name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;app1&#x27;</span><span class="token punctuation">,</span><span class="token plain"> entry</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;//locahost:7001&#x27;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"> name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;app2&#x27;</span><span class="token punctuation">,</span><span class="token plain"> entry</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;//locahost:7002&#x27;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div></li></ul><h2 id="adderrorhandlerremoveerrorhandler"><a aria-hidden="true" tabindex="-1" href="/qiankun/zh/api#adderrorhandlerremoveerrorhandler"><span class="icon icon-link"></span></a><a target="_blank" rel="noopener noreferrer" href="https://single-spa.js.org/docs/api#adderrorhandler">addErrorHandler/removeErrorHandler<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h2><h2 id="addglobaluncaughterrorhandlerhandler"><a aria-hidden="true" tabindex="-1" href="/qiankun/zh/api#addglobaluncaughterrorhandlerhandler"><span class="icon icon-link"></span></a><code>addGlobalUncaughtErrorHandler(handler)</code></h2><ul><li><p>参数</p><ul><li>handler - <code>(...args: any[]) =&gt; void</code> - 必选</li></ul></li><li><p>用法</p><p>添加全局的未捕获异常处理器。</p></li><li><p>示例</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token imports punctuation">{</span><span class="token imports"> addGlobalUncaughtErrorHandler </span><span class="token imports punctuation">}</span><span class="token plain"> </span><span class="token keyword">from</span><span class="token plain"> </span><span class="token string">&#x27;qiankun&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token function">addGlobalUncaughtErrorHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token plain">event</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">event</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div></li></ul><h2 id="removeglobaluncaughterrorhandlerhandler"><a aria-hidden="true" tabindex="-1" href="/qiankun/zh/api#removeglobaluncaughterrorhandlerhandler"><span class="icon icon-link"></span></a><code>removeGlobalUncaughtErrorHandler(handler)</code></h2><ul><li><p>参数</p><ul><li>handler - <code>(...args: any[]) =&gt; void</code> - 必选</li></ul></li><li><p>用法</p><p>移除全局的未捕获异常处理器。</p></li><li><p>示例</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token imports punctuation">{</span><span class="token imports"> removeGlobalUncaughtErrorHandler </span><span class="token imports punctuation">}</span><span class="token plain"> </span><span class="token keyword">from</span><span class="token plain"> </span><span class="token string">&#x27;qiankun&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token function">removeGlobalUncaughtErrorHandler</span><span class="token punctuation">(</span><span class="token plain">handler</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div></li></ul><h2 id="initglobalstatestate"><a aria-hidden="true" tabindex="-1" href="/qiankun/zh/api#initglobalstatestate"><span class="icon icon-link"></span></a><code>initGlobalState(state)</code></h2><ul><li><p>参数</p><ul><li>state - <code>Record&lt;string, any&gt;</code> - 必选</li></ul></li><li><p>用法</p><p>定义全局状态，并返回通信方法，建议在主应用使用，微应用通过 props 获取通信方法。</p></li><li><p>返回</p><ul><li><p>MicroAppStateActions</p><ul><li><p>onGlobalStateChange: <code>(callback: OnGlobalStateChangeCallback, fireImmediately?: boolean) =&gt; void</code>， 在当前应用监听全局状态，有变更触发 callback，fireImmediately = true 立即触发 callback</p></li><li><p>setGlobalState: <code>(state: Record&lt;string, any&gt;) =&gt; boolean</code>， 按一级属性设置全局状态，微应用中只能修改已存在的一级属性</p></li><li><p>offGlobalStateChange: <code>() =&gt; boolean</code>，移除当前应用的状态监听，微应用 umount 时会默认调用</p></li></ul></li></ul></li><li><p>示例</p><p>主应用：</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token imports punctuation">{</span><span class="token imports"> initGlobalState</span><span class="token imports punctuation">,</span><span class="token imports"> </span><span class="token imports maybe-class-name">MicroAppStateActions</span><span class="token imports"> </span><span class="token imports punctuation">}</span><span class="token plain"> </span><span class="token keyword">from</span><span class="token plain"> </span><span class="token string">&#x27;qiankun&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 初始化 state</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> actions</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">MicroAppStateActions</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">initGlobalState</span><span class="token punctuation">(</span><span class="token plain">state</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">actions</span><span class="token punctuation">.</span><span class="token method function property-access">onGlobalStateChange</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token plain">state</span><span class="token punctuation">,</span><span class="token plain"> prev</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// state: 变更后的状态; prev 变更前的状态</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">state</span><span class="token punctuation">,</span><span class="token plain"> prev</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">actions</span><span class="token punctuation">.</span><span class="token method function property-access">setGlobalState</span><span class="token punctuation">(</span><span class="token plain">state</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">actions</span><span class="token punctuation">.</span><span class="token method function property-access">offGlobalStateChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>微应用：</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment">// 从生命周期 mount 中获取通信方法，使用方式和 master 一致</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">export</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token plain">props</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  props</span><span class="token punctuation">.</span><span class="token method function property-access">onGlobalStateChange</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token plain">state</span><span class="token punctuation">,</span><span class="token plain"> prev</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// state: 变更后的状态; prev 变更前的状态</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">state</span><span class="token punctuation">,</span><span class="token plain"> prev</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  props</span><span class="token punctuation">.</span><span class="token method function property-access">setGlobalState</span><span class="token punctuation">(</span><span class="token plain">state</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div></li></ul></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/kuitos/qiankun/edit/master/docs/api/README.zh.md">在 GitHub 上编辑此页<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="最后更新时间：">7/27/2021 13:14:42</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script>
      (function () {
        if (!location.port) {
          (function (i, s, o, g, r, a, m) {
            i["GoogleAnalyticsObject"] = r;
            (i[r] =
              i[r] ||
              function () {
                (i[r].q = i[r].q || []).push(arguments);
              }),
              (i[r].l = 1 * new Date());
            (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m);
          })(
            window,
            document,
            "script",
            "//www.google-analytics.com/analytics.js",
            "ga"
          );
          ga("create", "UA-157295698-1", "auto");
          ga("send", "pageview");
        }
      })();
    </script>
    <script src="/qiankun/umi.2968c678.js"></script>
  </body>
</html>
